<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-11-14 Tue 17:09 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KMonad</title>
<meta name="author" content="Sridaran Thoniyil" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/bigblow_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/bigblow_theme/css/bigblow.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/bigblow_theme/css/hideshow.css"/>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/bigblow.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/hideshow.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<style>pre.src{font-family: Fira Code, JetBrains Mono, Hack, monospace;}</style>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">KMonad</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org12421af">1. Configuration</a>
<ul>
<li><a href="#orgd9837e0">1.1. Global Variables</a>
<ul>
<li><a href="#orge364d17">1.1.1. Program Paths</a></li>
</ul>
</li>
<li><a href="#org9cb736a">1.2. Configuration</a>
<ul>
<li><a href="#org4012918">1.2.1. Constants</a></li>
</ul>
</li>
<li><a href="#org6865ae6">1.3. Keyboard Backlight Aliases</a></li>
<li><a href="#org344b502">1.4. Default Layer</a></li>
<li><a href="#org66010d6">1.5. Base Leader Key Layer</a></li>
<li><a href="#org675dde6">1.6. Window Focusing Layer</a></li>
<li><a href="#org2b4dfd4">1.7. Home Row Chord Layer</a></li>
<li><a href="#org937af27">1.8. Numeric Desktop Switching Layer</a>
<ul>
<li><a href="#org21279a1">1.8.1. Swap Monitors Script</a></li>
<li><a href="#org031086f">1.8.2. Monitor Relative Move Script</a></li>
</ul>
</li>
<li><a href="#orgf7b71fc">1.9. Alphabetic Window Tiling Layer</a></li>
<li><a href="#org4ba7856">1.10. Backslash Layer</a></li>
<li><a href="#orga11a541">1.11. Home Row Movement Layer</a></li>
<li><a href="#orge279f4b">1.12. Program Paths</a></li>
<li><a href="#org5cefe9d">1.13. Jump List</a>
<ul>
<li><a href="#orgee5fa02">1.13.1. Underlying Implementation</a></li>
</ul>
</li>
<li><a href="#orgbc2f631">1.14. Window Switcher</a></li>
<li><a href="#org728d4b4">1.15. Discord</a>
<ul>
<li><a href="#org4620fc5">1.15.1. <span class="todo TODO">TODO</span> Switch back to the previous window when invoked a second time</a></li>
</ul>
</li>
<li><a href="#orgcd40a99">1.16. Emacs</a></li>
<li><a href="#org57c0a79">1.17. Firefox</a>
<ul>
<li><a href="#org695a6d9">1.17.1. Firefox Tab Switcher</a></li>
</ul>
</li>
<li><a href="#orgc2ac15e">1.18. Brightness</a>
<ul>
<li><a href="#org3a59c1e">1.18.1. Queue Digit Script</a></li>
<li><a href="#org9345db3">1.18.2. Change Brightness Script</a></li>
<li><a href="#org866d694">1.18.3. Change Backlight Script</a></li>
</ul>
</li>
<li><a href="#org3a4f1ba">1.19. <span class="todo TODO">TODO</span> Terminal</a></li>
<li><a href="#orge7082ab">1.20. Run</a>
<ul>
<li><a href="#org0299f77">1.20.1. Runner Script</a></li>
<li><a href="#orgcd61491">1.20.2. Autoresizing on commands</a></li>
<li><a href="#org251a54b">1.20.3. <span class="todo TODO">TODO</span> Cleanup exit command</a></li>
<li><a href="#org6719161">1.20.4. <span class="done DONE">DONE</span> Reuse the <code>runner</code> terminal and shell between invocations</a></li>
</ul>
</li>
<li><a href="#org44bc6af">1.21. <span class="todo TODO">TODO</span> Prompt</a></li>
<li><a href="#orgc21d85a">1.22. Agenda</a>
<ul>
<li><a href="#org0f27848">1.22.1. <span class="todo TODO">TODO</span> Open a floating, semi-transparent window</a></li>
<li><a href="#org6c1ec65">1.22.2. <span class="done DONE">DONE</span> Maybe switch to org-agenda</a></li>
</ul>
</li>
<li><a href="#org48ee683">1.23. Open Preset</a></li>
<li><a href="#org5b2e75f">1.24. Org Capture</a></li>
<li><a href="#org711fd9f">1.25. Scroll</a>
<ul>
<li><a href="#org9cb2b49">1.25.1. Scroll Script</a></li>
<li><a href="#org4f1058e">1.25.2. Scroll Speed Script</a></li>
<li><a href="#org082bb9d">1.25.3. Original Approach</a></li>
</ul>
</li>
<li><a href="#orgc18a5cc">1.26. Volume</a>
<ul>
<li><a href="#org86c5e1b">1.26.1. Volume Script</a></li>
<li><a href="#org5db828a">1.26.2. Volume OSD Toggle Script</a></li>
<li><a href="#orgb5250d6">1.26.3. <span class="done DONE">DONE</span> Volume layer</a></li>
<li><a href="#org5e98de6">1.26.4. <span class="todo TODO">TODO</span> Volume Next/Prev</a></li>
</ul>
</li>
<li><a href="#orgb3e1602">1.27. Yank</a>
<ul>
<li><a href="#orgb5868a3">1.27.1. Yank Script</a></li>
</ul>
</li>
<li><a href="#orge87fff6">1.28. Switch Focus</a></li>
<li><a href="#orgd639a52">1.29. Vim</a>
<ul>
<li><a href="#orgdca269f">1.29.1. Run Neovim Script</a></li>
</ul>
</li>
<li><a href="#org743cedb">1.30. Simple Datetime Overlay</a>
<ul>
<li><a href="#org48088ac">1.30.1. Invoke Simple Datetime Overlay Script</a></li>
</ul>
</li>
<li><a href="#org54bd7d7">1.31. Buffer Procedures</a>
<ul>
<li><a href="#orgfd91741">1.31.1. Tangle and Compile</a></li>
</ul>
</li>
<li><a href="#org6e975c4">1.32. <span class="todo TODO">TODO</span> Local Leader</a></li>
</ul>
</li>
<li><a href="#org65b5f34">2. KMonad Documentation</a>
<ul>
<li><a href="#orge2c0203">2.1. Basic Syntax</a></li>
<li><a href="#orgc184e70">2.2. defcfg block</a></li>
<li><a href="#org91ef98e">2.3. defsrc block</a></li>
<li><a href="#org027b3fa">2.4. defalias</a></li>
<li><a href="#org0fdc0f8">2.5. deflayer</a>
<ul>
<li><a href="#org91e8139">2.5.1. Examples</a></li>
</ul>
</li>
<li><a href="#orgfb450d3">2.6. Buttons with Modifiers</a>
<ul>
<li><a href="#org2c47868">2.6.1. Examples</a></li>
</ul>
</li>
<li><a href="#orgb86e651">2.7. Sticky Keys</a>
<ul>
<li><a href="#org206bcf0">2.7.1. Examples</a></li>
</ul>
</li>
<li><a href="#orge878540">2.8. Tap Macros</a>
<ul>
<li><a href="#org49d2549">2.8.1. Examples</a></li>
</ul>
</li>
<li><a href="#orgc8aa6f2">2.9. Layer Manipulation</a>
<ul>
<li><a href="#org1bda5b0">2.9.1. Examples</a></li>
</ul>
</li>
<li><a href="#org1ba2d2e">2.10. Multi-use Buttons</a>
<ul>
<li><a href="#orge172632">2.10.1. Examples</a></li>
</ul>
</li>
<li><a href="#orgb5c04a8">2.11. Multi-tap</a>
<ul>
<li><a href="#orgc820926">2.11.1. Examples</a></li>
</ul>
</li>
<li><a href="#orgb976a06">2.12. Around-next</a>
<ul>
<li><a href="#org8926683">2.12.1. Examples</a></li>
</ul>
</li>
<li><a href="#org30b1890">2.13. Compose Key Sequences</a>
<ul>
<li><a href="#orgf3a3bde">2.13.1. Examples</a></li>
</ul>
</li>
<li><a href="#orgc6c7291">2.14. Command Buttons</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org12421af" class="outline-2">
<h2 id="org12421af"><span class="section-number-2">1.</span> Configuration</h2>
<div class="outline-text-2" id="text-1">
<p>
To allow for easier configuration, I am using &ldquo;variables&rdquo; for parts of the config that are subject to change between different setups.
These &ldquo;variables&rdquo; are implemented using Org mode&rsquo;s <a href="https://orgmode.org/manual/Noweb-Reference-Syntax.html">noweb</a> syntax, which allows for code blocks to insert the contents of other code blocks.
</p>

<p>
Because the default reference syntax: <code>&lt;&lt;BLOCK_NAME&gt;&gt;</code>, is valid syntax in some languages, I changed the syntax to <code>|&gt;BLOCK_NAME&lt;|</code>.
When the document is tangled, these <code>|&gt;BLOCK_NAME&lt;|</code> references are replaced with the contents of the corresponding named variable block in <a href="#orgd9837e0">1.1</a> or elsewhere.
Variable names are all uppercase, and their definitions will mirror the structure shown in <a href="#orgd9837e0">1.1</a>.
</p>
</div>
<div id="outline-container-orgd9837e0" class="outline-3">
<h3 id="orgd9837e0"><span class="section-number-3">1.1.</span> Global Variables</h3>
<div class="outline-text-3" id="text-1-1">
<dl class="org-dl">
<dt><code>KEYBOARD</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="orgc1b7fdc">/dev/input/by-id/usb-Logitech_USB_Receiver-if02-event-kbd
</pre>
</div></dd>
<dt><code>STARSHIP_RUNNER_CONFIG</code></dt><dd><p>
I want the runner to have a different configuration than my normal shell, so this points to the other config
</p>
<div class="org-src-container">
<pre class="src src-text" id="org558214c">~/.config/starship_runner.toml
</pre>
</div></dd>
</dl>
</div>
<div id="outline-container-orge364d17" class="outline-4">
<h4 id="orge364d17"><span class="section-number-4">1.1.1.</span> Program Paths</h4>
<div class="outline-text-4" id="text-1-1-1">
<dl class="org-dl">
<dt><code>ST</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="org6950d10">~/.local/bin/st
</pre>
</div></dd>
<dt><code>ROFI</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="orga439886">/usr/bin/rofi
</pre>
</div></dd>
<dt><code>EMACS</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="org749e08d">/usr/bin/emacs
</pre>
</div></dd>
<dt><code>EMACSCLIENT</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="orga99fc90">/usr/bin/emacsclient
</pre>
</div></dd>
<dt><code>DISCORD</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="org9f2e01d">/usr/bin/Discord
</pre>
</div></dd>
<dt><code>BROTAB</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="orge15800c">~/.local/bin/brotab
</pre>
</div></dd>
</dl>
</div>
</div>
</div>
<div id="outline-container-org9cb736a" class="outline-3">
<h3 id="org9cb736a"><span class="section-number-3">1.2.</span> Configuration</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">configuration</span>]
<span style="color: #dcaeea;">input</span> = <span style="color: #98be65;">"|&gt;KEYBOARD&lt;|"</span>

<span style="color: #dcaeea;">output-name</span> = <span style="color: #98be65;">"Logitech KMonad Output"</span>
<span style="color: #dcaeea;">output-pre-command</span> = <span style="color: #98be65;">"/usr/bin/sleep 0.75 &amp;&amp; /usr/bin/setxkbmap -option compose:rctrl"</span>

<span style="color: #dcaeea;">cmp-seq</span> = <span style="color: #98be65;">'rctrl'</span>
<span style="color: #dcaeea;">cmp-seq-delay</span> = <span style="color: #da8548; font-weight: bold;">5</span>

<span style="color: #dcaeea;">fallthrough</span> = <span style="color: #51afef;">true</span>
<span style="color: #dcaeea;">allow-cmd</span> = <span style="color: #51afef;">true</span>

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">indicate which layer you want to be in when KMonad launches</span>
<span style="color: #dcaeea;">starting-layer</span> = qwerty-homerow-mods
</pre>
</div>
</div>
<div id="outline-container-org4012918" class="outline-4">
<h4 id="org4012918"><span class="section-number-4">1.2.1.</span> Constants</h4>
<div class="outline-text-4" id="text-1-2-1">
<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">aliases</span>]
<span style="color: #dcaeea;">tap-hold-delay</span> = <span style="color: #da8548; font-weight: bold;">200</span>
<span style="color: #dcaeea;">tap-hold-delay-min</span> = <span style="color: #da8548; font-weight: bold;">160</span>

<span style="color: #dcaeea;">hmod-delay</span> = $tap-hold-delay

<span style="color: #dcaeea;">kwin_shortcut_cmd</span> = <span style="color: #98be65;">"qdbus org.kde.kglobalaccel /component/kwin invokeShortcut"</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org6865ae6" class="outline-3">
<h3 id="org6865ae6"><span class="section-number-3">1.3.</span> Keyboard Backlight Aliases</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Let&rsquo;s define buttons for increasing/decreasing the keyboard backlight.
These will be used in other layers so that I can easily see when I&rsquo;m in the base layer and when I&rsquo;m in a custom layer, like <a href="#orgc18a5cc">Volume</a>.
This will be done by turning on the backlight when in the layers, and turning it back off when leaving the layers.
</p>
<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">aliases</span>]
<span style="color: #dcaeea;">kbd-set-backlight-command</span> = <span style="color: #98be65;">"dbus-send --system --print-reply --dest=\"org.freedesktop.UPower\" /org/freedesktop/UPower/KbdBacklight org.freedesktop.UPower.KbdBacklight.SetBrightness"</span>
<span style="color: #dcaeea;">kbd-set-backlight-on-command</span> = <span style="color: #98be65;">"$kbd-set-backlight-command int32:1"</span>
<span style="color: #dcaeea;">kbd-set-backlight-off-command</span> = <span style="color: #98be65;">"$kbd-set-backlight-command int32:0"</span>

<span style="color: #dcaeea;">kbd-set-backlight-on</span> = (cmd-button <span style="color: #98be65;">"$kbd-set-backlight-command int32:1"</span>)
<span style="color: #dcaeea;">kbd-set-backlight-off</span> = (cmd-button <span style="color: #98be65;">"$kbd-set-backlight-command int32:0"</span>)
<span style="color: #dcaeea;">kbd-toggle-backlight</span> = (cmd-button <span style="color: #98be65;">"$kbd-set-backlight-on-command"</span> <span style="color: #98be65;">"$kbd-set-backlight-off-command"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org344b502" class="outline-3">
<h3 id="org344b502"><span class="section-number-3">1.4.</span> Default Layer</h3>
<div class="outline-text-3" id="text-1-4">
<blockquote>
<p>
Optional: as many layers as you please
</p>

<p>
We had already defined `num` as referring to a `(layer-toggle numbers)`. We
will get into layer-manipulation soon, but first, let&rsquo;s just create a second
layer that overlays a numpad under our right-hand.
</p>

<p>
To easily specify layers it is highly recommended to create an empty
`deflayer` statement as a comment at the top of your config, so you can simply
copy-paste this template. There are also various empty layer templates
available in the &rsquo;./keymap/template&rsquo; directory.
</p>
</blockquote>

<p>
Enable the &ldquo;leader&rdquo; layer for the next keypress.
If we release @leader_key <i>before</i> the next key, we treat the keypress as a <b>tap</b>, even if for a short period of time both keys were down.
If we release @leader_key <i>after</i> the next key, we treat it as holding.
</p>

<p>
Also, if we hold the key for more than 250 milliseconds, treat it like we are holding the key.
When we are trying to use the super key in a tap melody, we have the key down for a very short time, so having the hold timeout on 250ms lets us use it for chords more conveniently
</p>

<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">base</span>]
[[<span style="color: #ECBE7B;">private</span>]]
<span style="color: #dcaeea;">leader-key</span> = (tap-hold-next-release <span style="color: #da8548; font-weight: bold;">250</span> (around-next (layer-toggle leader)) lmet)
[[<span style="color: #ECBE7B;">keys</span>]]
<span style="color: #dcaeea;">lmet</span> = leader-key
<span id="coderef-simple-datetime-overlay" class="coderef-off"><span style="color: #dcaeea;">grave</span> = (tap-hold $tap-hold-delay-min grave @simple-datetime-overlay) <span style="color: #5B6268;">#</span> (simple-datetime-overlay)</span>
<span style="color: #dcaeea;">lalt</span> = (tap-hold-next-release $tap-hold-delay XX (around-next (layer-toggle leader-no-block)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">qwerty</span>]
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">we inherit from source before base so that we can add the `qwerty` on top of</span>
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">other layers and overwrite other mappings</span>
<span style="color: #dcaeea;">parent</span> = { source, base }
[[<span style="color: #ECBE7B;">private</span>]]
<span style="color: #dcaeea;">enable-homerow-mods</span> = (layer-switch qwerty-homerow-mods)
[[<span style="color: #ECBE7B;">keys</span>]]
<span style="color: #dcaeea;">ScrollLock</span> = enable-homerow-mods
<span style="color: #dcaeea;">caps</span> = <span style="color: #98be65;">'lctrl'</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">qwerty-homerow-mods</span>]
<span style="color: #dcaeea;">parent</span> = base
[[<span style="color: #ECBE7B;">private</span>]]
<span style="color: #dcaeea;">disable-homerow-mods</span> = (layer-switch qwerty)
</pre>
</div>

<p>
We want this key to act as escape when tapped, and lctrl when held.
However, while holding the key, we want to disable home row modifiers.
We do this by adding the stock qwerty layer on top of the stack <i>and</i> holding lctl while holding the key.
To do this,
</p>
<div class="org-src-container">
<pre class="src src-kbdx"><span style="color: #dcaeea;">lctrl-or-escape</span> = (tap-hold-next-release <span style="color: #da8548; font-weight: bold;">125</span> esc (around (layer-toggle qwerty) lctl))
<span style="color: #dcaeea;">lshift-or-caps-lock</span> = (tap-hold-next-release <span style="color: #da8548; font-weight: bold;">125</span> caps (around (layer-toggle qwerty) lshift))
<span style="color: #dcaeea;">rshift-or-caps-lock</span> = (tap-hold-next-release <span style="color: #da8548; font-weight: bold;">125</span> caps (around (layer-toggle qwerty) rshift))
</pre>
</div>

<p>
This is a <code>GACS</code> home-row-mods configuration detailed on <a href="https://precondition.github.io/home-row-mods#kmonad-home-row-mods-code-generator">this page</a>.
<code>k</code> is bound to <code>lctl</code> rather than <code>rctl</code> because <code>rctl</code> is the compose key on my system.
</p>
<div class="org-src-container">
<pre class="src src-kbdx"><span style="color: #dcaeea;">a_homerow_chords</span> = (tap-hold $hmod-delay a (layer-toggle home-row-chord))
<span style="color: #dcaeea;">q_homerow_movement</span> = (tap-hold $hmod-delay q (layer-toggle home-row-movement))
<span style="color: #dcaeea;">backslash_layer</span> = (tap-hold-next-release $hmod-delay \ (layer-toggle backslash))
<span style="color: #dcaeea;">s_lalt</span> = (tap-hold-next-release $hmod-delay s lalt)
<span style="color: #dcaeea;">d_lctrl</span> = (tap-hold-next-release $hmod-delay d lctl)
<span style="color: #dcaeea;">f_lshift</span> = (tap-hold-next-release $hmod-delay f lshift)

<span style="color: #dcaeea;">k_lctrl</span> = (tap-hold-next-release $hmod-delay k lctl)
<span style="color: #dcaeea;">j_rshift</span> = (tap-hold-next-release $hmod-delay j rshift)
<span style="color: #dcaeea;">l_ralt</span> = (tap-hold-next-release $hmod-delay l ralt)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kbdx">[[<span style="color: #ECBE7B;">keys</span>]]
<span style="color: #dcaeea;">ScrollLock</span> = disable-homerow-mods
<span style="color: #dcaeea;">caps</span> = lctrl-or-escape

<span style="color: #dcaeea;">a</span> = a_homerow_chords
<span style="color: #dcaeea;">q</span> = q_homerow_movement
<span style="color: #dcaeea;">backslash</span> = backslash_layer
<span style="color: #dcaeea;">s</span> = s_lalt
<span style="color: #dcaeea;">d</span> = d_lctrl
<span style="color: #dcaeea;">f</span> = f_lshift
<span style="color: #dcaeea;">k</span> = k_lctrl
<span style="color: #dcaeea;">j</span> = j_rshift
<span style="color: #dcaeea;">l</span> = l_ralt
</pre>
</div>

<p>
We want to disable the homerow mods whenever we explicitly hit a modifier key.
</p>
<div class="org-src-container">
<pre class="src src-kbdx"><span style="color: #dcaeea;">lshift</span> = (around (layer-toggle qwerty) @lshift-or-caps-lock)
<span style="color: #dcaeea;">rshift</span> = (around (layer-toggle qwerty) @rshift-or-caps-lock)
<span style="color: #dcaeea;">lctrl</span> = (around (layer-toggle qwerty) lctrl)
</pre>
</div>
</div>
</div>
<div id="outline-container-org66010d6" class="outline-3">
<h3 id="org66010d6"><span class="section-number-3">1.5.</span> Base Leader Key Layer</h3>
<div class="outline-text-3" id="text-1-5">
<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">leader</span>]
<span style="color: #dcaeea;">parent</span> = block
[[<span style="color: #ECBE7B;">keys</span>]]
<span id="coderef-window-switcher" class="coderef-off"><span style="color: #dcaeea;">q</span> = window-switcher:activate <span style="color: #5B6268;">#</span> (window-switcher)</span>
<span id="coderef-discord" class="coderef-off"><span style="color: #dcaeea;">d</span> = discord <span style="color: #5B6268;">#</span> (discord)</span>
<span id="coderef-emacs" class="coderef-off"><span style="color: #dcaeea;">e</span> = emacs <span style="color: #5B6268;">#</span> (emacs)</span>
<span id="coderef-firefox" class="coderef-off"><span style="color: #dcaeea;">f</span> = firefox_composite <span style="color: #5B6268;">#</span> (firefox)</span>
<span id="coderef-brightness" class="coderef-off"><span style="color: #dcaeea;">b</span> = brightness:enter <span style="color: #5B6268;">#</span> (brightness)</span>
<span id="coderef-volume" class="coderef-off"><span style="color: #dcaeea;">v</span> = volume:enter <span style="color: #5B6268;">#</span> (volume)</span>
<span id="coderef-terminal" class="coderef-off"><span style="color: #dcaeea;">t</span> = <span style="color: #98be65;">'t'</span> <span style="color: #5B6268;">#</span> (terminal)</span>
<span id="coderef-run" class="coderef-off"><span style="color: #dcaeea;">r</span> = run:entrypoint <span style="color: #5B6268;">#</span> (run)</span>
<span id="coderef-prompt" class="coderef-off"><span style="color: #dcaeea;">p</span> = <span style="color: #98be65;">'p'</span> <span style="color: #5B6268;">#</span> (prompt)</span>
<span id="coderef-agenda" class="coderef-off"><span style="color: #dcaeea;">a</span> = agenda <span style="color: #5B6268;">#</span> (agenda)</span>
<span id="coderef-open-preset" class="coderef-off"><span style="color: #dcaeea;">o</span> = open-preset <span style="color: #5B6268;">#</span> (open-preset)</span>
<span id="coderef-org-capture" class="coderef-off"><span style="color: #dcaeea;">c</span> = org-capture <span style="color: #5B6268;">#</span> (org-capture)</span>
<span id="coderef-scroll" class="coderef-off"><span style="color: #dcaeea;">s</span> = scroll:enter <span style="color: #5B6268;">#</span> (scroll)</span>
<span id="coderef-yank" class="coderef-off"><span style="color: #dcaeea;">y</span> = yank <span style="color: #5B6268;">#</span> (yank)</span>
<span id="coderef-switch-focus" class="coderef-off"><span style="color: #dcaeea;">tab</span> = switch_focus_composite <span style="color: #5B6268;">#</span> (switch-focus)</span>
<span id="coderef-vim" class="coderef-off"><span style="color: #dcaeea;">f1</span> = vim <span style="color: #5B6268;">#</span> (vim)</span>
<span id="coderef-local-leader" class="coderef-off"><span style="color: #dcaeea;">backslash</span> = <span style="color: #98be65;">'backslash'</span> <span style="color: #5B6268;">#</span> (local-leader)</span>
<span style="color: #dcaeea;">lmet</span> = <span style="color: #98be65;">'lmet'</span>

[<span style="color: #ECBE7B;">leader-no-block</span>]
<span style="color: #dcaeea;">parent</span> = { source, leader }
</pre>
</div>
</div>
</div>
<div id="outline-container-org675dde6" class="outline-3">
<h3 id="org675dde6"><span class="section-number-3">1.6.</span> Window Focusing Layer</h3>
<div class="outline-text-3" id="text-1-6">
<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">window-focusing</span>]
[[<span style="color: #ECBE7B;">public</span>]]
<span style="color: #dcaeea;">focus-left</span> = (around lmet (around lalt Left))
<span style="color: #dcaeea;">focus-down</span> = (around lmet (around lalt Down))
<span style="color: #dcaeea;">focus-up</span> = (around lmet (around lalt Up))
<span style="color: #dcaeea;">focus-right</span> = (around lmet (around lalt Right))
[[<span style="color: #ECBE7B;">keys</span>]]
<span style="color: #dcaeea;">h</span> = focus-left
<span style="color: #dcaeea;">j</span> = focus-down
<span style="color: #dcaeea;">k</span> = focus-up
<span style="color: #dcaeea;">l</span> = focus-right
</pre>
</div>
</div>
</div>
<div id="outline-container-org2b4dfd4" class="outline-3">
<h3 id="org2b4dfd4"><span class="section-number-3">1.7.</span> Home Row Chord Layer</h3>
<div class="outline-text-3" id="text-1-7">
<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">home-row-chord</span>]
<span style="color: #dcaeea;">parent</span> = { block, numeric-desktop-switching, window-focusing }
[[<span style="color: #ECBE7B;">private</span>]]
<span style="color: #dcaeea;">show_desktop_grid</span> = (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"ShowDesktopGrid\""</span>)
<span style="color: #dcaeea;">show_current_desktop_windows</span> = (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"Expose\""</span>)
[[<span style="color: #ECBE7B;">keys</span>]]
<span id="coderef-jump-list" class="coderef-off"><span style="color: #dcaeea;">i</span> = jump-list:next <span style="color: #5B6268;">#</span> (jump-list)</span>
<span style="color: #dcaeea;">o</span> = jump-list:prev
<span style="color: #dcaeea;">p</span> = jump-list:add

<span style="color: #dcaeea;">backslash</span> = (tap-hold-next-release $tap-hold-delay-min @show_current_desktop_windows @show_desktop_grid)
</pre>
</div>
</div>
</div>
<div id="outline-container-org937af27" class="outline-3">
<h3 id="org937af27"><span class="section-number-3">1.8.</span> Numeric Desktop Switching Layer</h3>
<div class="outline-text-3" id="text-1-8">
<p>
This is a layer where the numeric keys are mapped to buttons that switch to that numbered desktop.
</p>

<dl class="org-dl">
<dt><code>SWAP_MONITOR_WINDOWS_SCRIPT</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="orgbdeeec1">~/.config/kmonad/windows/swap_monitor_windows.sh
</pre>
</div></dd>

<dt><code>MONITOR_MOVE_RELATIVE_SCRIPT</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="org522b693">~/.config/kmonad/windows/monitor_move_relative.sh
</pre>
</div></dd>
</dl>

<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">numeric-desktop-switching</span>]
[[<span style="color: #ECBE7B;">private</span>]]
<span style="color: #dcaeea;">SWAP_MONITOR_WINDOWS_SCRIPT</span> = <span style="color: #98be65;">"|&gt;SWAP_MONITOR_WINDOWS_SCRIPT&lt;|"</span>
<span style="color: #dcaeea;">MONITOR_MOVE_RELATIVE_SCRIPT</span> = <span style="color: #98be65;">"|&gt;MONITOR_MOVE_RELATIVE_SCRIPT&lt;|"</span>

<span style="color: #dcaeea;">window_to_next_screen</span> = (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"Window to Next Screen\""</span>)
[[<span style="color: #ECBE7B;">keys</span>]]
</pre>
</div>

<p>
Let&rsquo;s generate this repetitive code with Python.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #51afef;">return</span> <span style="color: #98be65;">'</span><span style="color: #a9a1e1;">\n</span><span style="color: #98be65;">'</span>.join(
    <span style="color: #c678dd;">map</span>(<span style="color: #51afef;">lambda</span> n: f<span style="color: #98be65;">'</span>{n}<span style="color: #98be65;"> = (tap-hold $tap-hold-delay-min (cmd-button "$kwin_shortcut_cmd </span><span style="color: #a9a1e1;">\\</span><span style="color: #98be65;">"Switch to Desktop </span>{n}<span style="color: #a9a1e1;">\\</span><span style="color: #98be65;">"") (cmd-button "$kwin_shortcut_cmd </span><span style="color: #a9a1e1;">\\</span><span style="color: #98be65;">"Window to Desktop </span>{n}<span style="color: #a9a1e1;">\\</span><span style="color: #98be65;">""))'</span>,
        <span style="color: #c678dd;">range</span>(<span style="color: #da8548; font-weight: bold;">1</span>, <span style="color: #da8548; font-weight: bold;">10</span>)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kbdx"><span style="color: #da8548; font-weight: bold;">1</span> = (tap-hold $tap-hold-delay-min (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"Switch to Desktop 1\""</span>) (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"Window to Desktop 1\""</span>))
<span style="color: #da8548; font-weight: bold;">2</span> = (tap-hold $tap-hold-delay-min (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"Switch to Desktop 2\""</span>) (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"Window to Desktop 2\""</span>))
<span style="color: #da8548; font-weight: bold;">3</span> = (tap-hold $tap-hold-delay-min (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"Switch to Desktop 3\""</span>) (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"Window to Desktop 3\""</span>))
<span style="color: #da8548; font-weight: bold;">4</span> = (tap-hold $tap-hold-delay-min (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"Switch to Desktop 4\""</span>) (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"Window to Desktop 4\""</span>))
<span style="color: #da8548; font-weight: bold;">5</span> = (tap-hold $tap-hold-delay-min (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"Switch to Desktop 5\""</span>) (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"Window to Desktop 5\""</span>))
<span style="color: #da8548; font-weight: bold;">6</span> = (tap-hold $tap-hold-delay-min (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"Switch to Desktop 6\""</span>) (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"Window to Desktop 6\""</span>))
<span style="color: #da8548; font-weight: bold;">7</span> = (tap-hold $tap-hold-delay-min (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"Switch to Desktop 7\""</span>) (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"Window to Desktop 7\""</span>))
<span style="color: #da8548; font-weight: bold;">8</span> = (tap-hold $tap-hold-delay-min (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"Switch to Desktop 8\""</span>) (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"Window to Desktop 8\""</span>))
<span style="color: #da8548; font-weight: bold;">9</span> = (tap-hold $tap-hold-delay-min (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"Switch to Desktop 9\""</span>) (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"Window to Desktop 9\""</span>))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kbdx"><span style="color: #5B6268;"># </span><span style="color: #5B6268;">go to previous desktop</span>
<span style="color: #dcaeea;">semicolon</span> = (tap-hold $tap-hold-delay-min (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"Switch to Previous Desktop\""</span>) (cmd-button <span style="color: #98be65;">"$MONITOR_MOVE_RELATIVE_SCRIPT -1"</span>))
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">go to next desktop</span>
<span style="color: #dcaeea;">apostrophe</span> = (tap-hold $tap-hold-delay-min (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd \"Switch to Next Desktop\""</span>) (cmd-button <span style="color: #98be65;">"$MONITOR_MOVE_RELATIVE_SCRIPT 1"</span>))

<span style="color: #dcaeea;">Minus</span> = (cmd-button <span style="color: #98be65;">"$SWAP_MONITOR_WINDOWS_SCRIPT"</span>)
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">NOTE: this approach only works with 2 monitors</span>
<span style="color: #dcaeea;">Equal</span> = (tap-hold $tap-hold-delay-min @window_to_next_screen <span style="color: #5B6268;">#</span><span style="color: #5B6268;">(@window_to_next_screen @switch_focus_screen))</span>
</pre>
</div>
</div>
<div id="outline-container-org21279a1" class="outline-4">
<h4 id="org21279a1"><span class="section-number-4">1.8.1.</span> Swap Monitors Script</h4>
<div class="outline-text-4" id="text-1-8-1">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #5B6268;">#</span><span style="color: #5B6268;">!/bin/</span><span style="color: #51afef;">dash</span>

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">first, get the current window ID</span>
<span style="color: #dcaeea;">WINDOW_ID</span>=$<span style="color: #51afef;">(</span>xdotool getactivewindow<span style="color: #51afef;">)</span>

<span style="color: #c678dd;">runShortcut</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
    qdbus org.kde.kglobalaccel /component/kwin invokeShortcut <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">1</span><span style="color: #98be65;">"</span>
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">next, switch focus to the other monitor</span>
runShortcut <span style="color: #98be65;">"Switch to Next Screen"</span>

<span style="color: #ECBE7B;">sleep</span> <span style="color: #da8548; font-weight: bold;">0.05</span>

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">now, move the window to the previous monitor</span>
runShortcut <span style="color: #98be65;">"Window to Next Screen"</span>

<span style="color: #ECBE7B;">sleep</span> <span style="color: #da8548; font-weight: bold;">0.05</span>

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">finally, focus the original window and move it to the other monitor</span>
xdotool windowfocus <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">WINDOW_ID</span><span style="color: #98be65;">"</span>

<span style="color: #ECBE7B;">sleep</span> <span style="color: #da8548; font-weight: bold;">0.05</span>

runShortcut <span style="color: #98be65;">"Window to Next Screen"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org031086f" class="outline-4">
<h4 id="org031086f"><span class="section-number-4">1.8.2.</span> Monitor Relative Move Script</h4>
<div class="outline-text-4" id="text-1-8-2">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #5B6268;">#</span><span style="color: #5B6268;">!/bin/</span><span style="color: #51afef;">bash</span>

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">pass in the relative change in desktop numbers; i.e 1, -1</span>
<span style="color: #dcaeea;">relative_change</span>=$<span style="color: #da8548; font-weight: bold;">1</span>

<span style="color: #c678dd;">runShortcut</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
    qdbus org.kde.kglobalaccel /component/kwin invokeShortcut <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">1</span><span style="color: #98be65;">"</span>
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">first, let's get the current desktop</span>
<span style="color: #dcaeea;">wmctrl_output</span>=$<span style="color: #51afef;">(</span>wmctrl -d<span style="color: #51afef;">)</span>

<span style="color: #dcaeea;">desktop_regex</span>=<span style="color: #98be65;">"^([0-9]+)"</span>
<span style="color: #dcaeea;">active_desktop_regex</span>=<span style="color: #98be65;">"([0-9]+)  \\*"</span>

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">1. </span><span style="color: #5B6268;">find</span><span style="color: #5B6268;"> the current desktop</span>
<span style="color: #51afef;">if</span> <span style="color: #51afef;">[</span><span style="color: #c678dd;">[</span> $<span style="color: #dcaeea;">wmctrl_output</span> =~ $<span style="color: #dcaeea;">active_desktop_regex</span> <span style="color: #c678dd;">]</span><span style="color: #51afef;">]</span>
<span style="color: #51afef;">then</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">this is zero-based</span>
    <span style="color: #dcaeea;">active_desktop</span>=<span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">{BASH_REMATCH[1]}</span><span style="color: #98be65;">"</span>

    <span style="color: #dcaeea;">last_desktop_line</span>=$<span style="color: #51afef;">(</span><span style="color: #ECBE7B;">echo</span> <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">wmctrl_output</span><span style="color: #98be65;">"</span> | tail -n <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span>

    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">let's take that line and extract the number from it</span>
    <span style="color: #51afef;">if</span> <span style="color: #51afef;">[</span><span style="color: #c678dd;">[</span> $<span style="color: #dcaeea;">last_desktop_line</span> =~ $<span style="color: #dcaeea;">desktop_regex</span> <span style="color: #c678dd;">]</span><span style="color: #51afef;">]</span>
    <span style="color: #51afef;">then</span>
        <span style="color: #5B6268;"># </span><span style="color: #5B6268;">this is zero-based</span>
        <span style="color: #dcaeea;">highest_desktop</span>=<span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">{BASH_REMATCH[1]}</span><span style="color: #98be65;">"</span>
        <span style="color: #dcaeea;">num_desktops</span>=$<span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>highest_desktop + <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

        <span style="color: #dcaeea;">new_desktop</span>=$<span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span>active_desktop + relative_change<span style="color: #98be65;">)</span> % num_desktops<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">if</span> <span style="color: #51afef;">[</span><span style="color: #c678dd;">[</span> $<span style="color: #dcaeea;">new_desktop</span> -lt <span style="color: #da8548; font-weight: bold;">0</span> <span style="color: #c678dd;">]</span><span style="color: #51afef;">]</span>
        <span style="color: #51afef;">then</span>
            <span style="color: #dcaeea;">new_desktop</span>=$<span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>new_desktop + num_desktops<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">fi</span>

        <span style="color: #5B6268;"># </span><span style="color: #5B6268;">take it from zero-based to one-based</span>
        <span style="color: #dcaeea;">new_desktop</span>=$<span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>new_desktop + <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

        <span style="color: #5B6268;"># </span><span style="color: #5B6268;">finally, move the window</span>
        runShortcut <span style="color: #98be65;">"Window to Desktop </span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">new_desktop</span><span style="color: #98be65;">"</span>
    <span style="color: #51afef;">fi</span>
<span style="color: #51afef;">fi</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf7b71fc" class="outline-3">
<h3 id="orgf7b71fc"><span class="section-number-3">1.9.</span> Alphabetic Window Tiling Layer</h3>
<div class="outline-text-3" id="text-1-9">
<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">alphabetic-window-tiling</span>]
[[<span style="color: #ECBE7B;">keys</span>]]
<span style="color: #dcaeea;">u</span> = (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd 'Window Quick Tile Top Left'"</span>)
<span style="color: #dcaeea;">i</span> = (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd 'Window Quick Tile Top'"</span>)
<span style="color: #dcaeea;">o</span> = (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd 'Window Quick Tile Top Right'"</span>)

<span style="color: #dcaeea;">j</span> = (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd 'Window Quick Tile Left'"</span>)
<span style="color: #dcaeea;">k</span> = (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd 'Window Maximize'"</span>)
<span style="color: #dcaeea;">l</span> = (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd 'Window Quick Tile Right'"</span>)

<span style="color: #dcaeea;">m</span> = (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd 'Window Quick Tile Bottom Left'"</span>)
<span style="color: #dcaeea;">comma</span> = (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd 'Window Quick Tile Bottom'"</span>)
<span style="color: #dcaeea;">dot</span> = (cmd-button <span style="color: #98be65;">"$kwin_shortcut_cmd 'Window Quick Tile Bottom Right'"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org4ba7856" class="outline-3">
<h3 id="org4ba7856"><span class="section-number-3">1.10.</span> Backslash Layer</h3>
<div class="outline-text-3" id="text-1-10">
<p>
This used to be the &ldquo;Desktop/Window&rdquo; layer, but after adding leader key functionality, the backslash key now constitutes its own dedicated layer name.
</p>
<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">backslash</span>]
<span style="color: #dcaeea;">parent</span> = { numeric-desktop-switching, alphabetic-window-tiling, leader }
[[<span style="color: #ECBE7B;">keys</span>]]
<span style="color: #dcaeea;">RightBrace</span> = window-focusing:focus-right
<span style="color: #dcaeea;">LeftBrace</span> = window-focusing:focus-left
</pre>
</div>
</div>
</div>
<div id="outline-container-orga11a541" class="outline-3">
<h3 id="orga11a541"><span class="section-number-3">1.11.</span> Home Row Movement Layer</h3>
<div class="outline-text-3" id="text-1-11">
<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">home-row-movement</span>]
[[<span style="color: #ECBE7B;">keys</span>]]
<span style="color: #dcaeea;">h</span> = <span style="color: #98be65;">'Left'</span>
<span style="color: #dcaeea;">j</span> = <span style="color: #98be65;">'Down'</span>
<span style="color: #dcaeea;">k</span> = <span style="color: #98be65;">'Up'</span>
<span style="color: #dcaeea;">l</span> = <span style="color: #98be65;">'Right'</span>

<span style="color: #dcaeea;">b</span> = <span style="color: #98be65;">'PageUp'</span>
<span style="color: #dcaeea;">f</span> = <span style="color: #98be65;">'PageDown'</span>

<span style="color: #dcaeea;">e</span> = (around lctl Right)
<span style="color: #dcaeea;">w</span> = (around lctl Left)

<span style="color: #dcaeea;">semicolon</span> = <span style="color: #98be65;">'Home'</span>
<span style="color: #dcaeea;">apostrophe</span> = <span style="color: #98be65;">'End'</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orge279f4b" class="outline-3">
<h3 id="orge279f4b"><span class="section-number-3">1.12.</span> Program Paths</h3>
<div class="outline-text-3" id="text-1-12">
<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">aliases</span>]
<span style="color: #dcaeea;">ROFI</span> = <span style="color: #98be65;">"|&gt;ROFI&lt;|"</span>
<span style="color: #dcaeea;">DISCORD</span> = <span style="color: #98be65;">"|&gt;DISCORD&lt;|"</span>
<span style="color: #dcaeea;">EMACS</span> = <span style="color: #98be65;">"|&gt;EMACS&lt;|"</span>
<span style="color: #dcaeea;">EMACSCLIENT</span> = <span style="color: #98be65;">"|&gt;EMACSCLIENT&lt;|"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org5cefe9d" class="outline-3">
<h3 id="org5cefe9d"><span class="section-number-3">1.13.</span> <a href="#coderef-jump-list" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-jump-list');" onmouseout="CodeHighlightOff(this, 'coderef-jump-list');">Jump List</a></h3>
<div class="outline-text-3" id="text-1-13">
<p>
The idea of the Jump List is to emulate Vim behavior and allow for switching between different positions.
In a windowing system context, each entry in the Jump List is an active window (+ Desktop).
Vim has a ton of operations which modify the Jump List, but for our purposes, we will have two main modes of modification:
</p>
<ol class="org-ol">
<li><a href="#orgbc2f631">Window Switcher</a>
<ul class="org-ul">
<li>using the window switcher will automatically add entries to the Jump List</li>
</ul></li>
<li>Manual Marks
<ul class="org-ul">
<li>to fill in for the Vim operations, we will provide an easy way to mark an entry in the Jump List through a direct keybinding</li>
</ul></li>

<li value="JUMP_LIST_SCRIPT"><div class="org-src-container">
<pre class="src src-text" id="org8fbb3ad">/home/sridaran/.config/kmonad/jump-list/jump_list.pl
</pre>
</div></li>
</ol>

<p>
We move the command to the global scope so we can use it within other layers.
</p>
<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">aliases</span>]
<span style="color: #dcaeea;">jump-list-mark</span> = <span style="color: #98be65;">"|&gt;JUMP_LIST_SCRIPT&lt;| add-shift"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">jump-list</span>]
[[<span style="color: #ECBE7B;">private</span>]]
<span style="color: #dcaeea;">script</span> = <span style="color: #98be65;">"|&gt;JUMP_LIST_SCRIPT&lt;|"</span>
[[<span style="color: #ECBE7B;">public</span>]]
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">adds current window as entry to the jump list</span>
<span style="color: #dcaeea;">add</span> = (cmd-button <span style="color: #98be65;">"$script add-replace"</span>)

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">jumps to the next entry in the jump list</span>
<span style="color: #dcaeea;">next</span> = (cmd-button <span style="color: #98be65;">"$script next"</span>)
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">jumps to the previous entry in the jump list</span>
<span style="color: #dcaeea;">prev</span> = (cmd-button <span style="color: #98be65;">"$script prev"</span>)
</pre>
</div>
</div>
<div id="outline-container-orgee5fa02" class="outline-4">
<h4 id="orgee5fa02"><span class="section-number-4">1.13.1.</span> Underlying Implementation</h4>
<div class="outline-text-4" id="text-1-13-1">
<p>
To make the underlying implementation work, we need to maintain a stack of jump list entries, where each entry contains a Window ID as well as a desktop number + monitor so that if the window is closed, we can still go back to it.
Actually, it may make sense to simply skip an entry if the window has been closed.
</p>

<ul class="org-ul">
<li>When using <code>prev</code> from a monitor which is different from the active jump list entry (this means that you manually moved away), we can either go back to the active entry OR ignore the current monitor and simply go back an entry
<ul class="org-ul">
<li>Similarly, when using <code>next</code> from a monitor which is different from the active jump list entry, we can either go back to the active entry OR ignore the current monitor and simply go back an entry</li>
<li>I think we will have to see what is more useful in practice, but I think to begin with it&rsquo;ll be good to have it go back to the active entry in the <code>prev</code> scenario
<ul class="org-ul">
<li>If it gets in the way, we&rsquo;ll get rid of it</li>
</ul></li>
</ul></li>

<li><code>add</code> should get the current focused window id and desktop, and add it to the jump list
<ul class="org-ul">
<li>If the current entry is not the latest entry, then delete anything that came after it (this appears to be Vim&rsquo;s behavior, too)</li>
</ul></li>

<li><code>prev</code> should shift the pointer back</li>

<li><code>next</code> should move the pointer forward, and do nothing if it isn&rsquo;t relevant</li>
</ul>

<div class="org-src-container">
<pre class="src src-perl"><span style="color: #5B6268;">#</span><span style="color: #5B6268;">!/bin/env perl</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-perl"><span style="color: #51afef;">use</span> <span style="color: #a9a1e1;">v5</span>.<span style="color: #da8548; font-weight: bold;">28</span>;
<span style="color: #51afef;">use</span> <span style="color: #a9a1e1;">strict</span>;
<span style="color: #51afef;">use</span> <span style="color: #a9a1e1;">warnings</span>;

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">first, let's get the current window configuration: current window id and desktop</span>
<span style="color: #51afef;">my</span> $<span style="color: #dcaeea;">focusedWindow</span> = <span style="color: #98be65;">`xdotool getwindowfocus`</span>;
chomp $<span style="color: #dcaeea;">focusedWindow</span>;

<span style="color: #51afef;">sub</span> <span style="color: #c678dd;">getCurrentDesktop</span> {
    <span style="color: #51afef;">my</span> $<span style="color: #dcaeea;">cmd</span> = <span style="color: #98be65;">"wmctrl -d |"</span>;
    open FH, $<span style="color: #dcaeea;">cmd</span>;

    <span style="color: #51afef;">my</span> $<span style="color: #dcaeea;">currentDesktop</span>;
    <span style="color: #51afef;">while</span> (&lt;<span style="color: #a9a1e1;">FH</span>&gt;) {
        <span style="color: #51afef;">if</span> ($<span style="color: #dcaeea;">_</span> =~ m<span style="color: #98be65;">/^(?&lt;n&gt;\d)  \*/</span>) {
            <span style="color: #5B6268;"># MISTAKE: `chomp(lval)` yields the number of removed characters from the end;</span>
            <span style="color: #5B6268;"># also, chomp wasn't even necessary here.</span>
            $<span style="color: #dcaeea;">currentDesktop</span> = $+{n};
            <span style="color: #51afef;">last</span>;
        }
    }

    close FH;
    <span style="color: #51afef;">return</span> $<span style="color: #dcaeea;">currentDesktop</span>;
}

<span style="color: #51afef;">my</span> $<span style="color: #dcaeea;">currentDesktop</span> = getCurrentDesktop();

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">now, let's define the path for the jump list file.</span>
<span style="color: #51afef;">my</span> $<span style="color: #dcaeea;">jumpListPath</span> = <span style="color: #98be65;">"/tmp/kmonad_jump_list"</span>;
<span style="color: #51afef;">my</span> $<span style="color: #dcaeea;">fileExists</span> = open(FH, <span style="color: #98be65;">'&lt;'</span>, $<span style="color: #dcaeea;">jumpListPath</span>);

<span style="color: #51afef;">my</span> $<span style="color: #dcaeea;">activeEntryNum</span> = -<span style="color: #da8548; font-weight: bold;">1</span>;
<span style="color: #51afef;">my</span> @<span style="color: #dcaeea; text-decoration: underline;">currentJumpList</span> = ();
<span style="color: #51afef;">if</span> ($<span style="color: #dcaeea;">fileExists</span>) {
    $<span style="color: #dcaeea;">activeEntryNum</span> = &lt;<span style="color: #a9a1e1;">FH</span>&gt;;
    <span style="color: #5B6268;"># source: https://stackoverflow.com/questions/1877330/how-can-i-read-the-lines-of-a-file-into-an-array-in-perl</span>

    <span style="color: #51afef;">while</span> (&lt;<span style="color: #a9a1e1;">FH</span>&gt;) {
        chomp;
        <span style="color: #51afef;">my</span> @<span style="color: #dcaeea; text-decoration: underline;">items</span> = split <span style="color: #98be65;">/ /</span>;
        <span style="color: #5B6268;"># MISTAKE: `push @list @other` actually pushes the ELEMENTS of @other onto @list.</span>
        <span style="color: #5B6268;"># to remedy this, we push a scalar reference to the array</span>
        push @<span style="color: #dcaeea; text-decoration: underline;">currentJumpList</span>, \@<span style="color: #dcaeea; text-decoration: underline;">items</span>;
    }
}

close FH;

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">we use a queue for our commands so that we can run them after updating the file</span>
<span style="color: #51afef;">my</span> @<span style="color: #dcaeea; text-decoration: underline;">commandQueue</span> = ();

<span style="color: #51afef;">sub</span> <span style="color: #c678dd;">addJumpPredicate</span> {
    <span style="color: #5B6268;"># check if it's the KDE desktop background window</span>
    <span style="color: #51afef;">my</span> $<span style="color: #dcaeea;">classOutput</span> = <span style="color: #98be65;">`xprop -notype -id $focusedWindow WM_CLASS`</span>;
    <span style="color: #51afef;">die</span> <span style="color: #51afef;">if</span> not $<span style="color: #dcaeea;">classOutput</span> =~ m<span style="color: #98be65;">/WM_CLASS = "(?&lt;CLASS&gt;[^"]+)",/</span>;

    <span style="color: #51afef;">return</span> ($+{CLASS} !~ m<span style="color: #98be65;">/plasmashell/</span>);
}

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">this function takes in no args.</span>
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">it will mutate the @currentJumpList array, setting the current window</span>
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">configuration as the latest entry.</span>
<span style="color: #51afef;">sub</span> <span style="color: #c678dd;">addJumpEntry</span> {
    <span style="color: #51afef;">my</span> ($<span style="color: #dcaeea;">keepLaterEntries</span>) = @<span style="color: #dcaeea; text-decoration: underline;">_</span>;

    <span style="color: #51afef;">if</span> (addJumpPredicate) {
        $<span style="color: #dcaeea;">activeEntryNum</span> += <span style="color: #da8548; font-weight: bold;">1</span>;

        <span style="color: #51afef;">my</span> $<span style="color: #dcaeea;">newEntry</span> = [$<span style="color: #dcaeea;">currentDesktop</span>, $<span style="color: #dcaeea;">focusedWindow</span>];
        <span style="color: #51afef;">if</span> ($<span style="color: #dcaeea;">keepLaterEntries</span>) {
            <span style="color: #5B6268;"># push back everything after</span>
            splice @<span style="color: #dcaeea; text-decoration: underline;">currentJumpList</span>, $<span style="color: #dcaeea;">activeEntryNum</span>, <span style="color: #da8548; font-weight: bold;">0</span>, $<span style="color: #dcaeea;">newEntry</span>;
        } <span style="color: #51afef;">else</span> {
            $<span style="color: #dcaeea;">currentJumpList</span>[$<span style="color: #dcaeea;">activeEntryNum</span>] = $<span style="color: #dcaeea;">newEntry</span>;

            <span style="color: #5B6268;"># remove all elements after</span>
            splice @<span style="color: #dcaeea; text-decoration: underline;">currentJumpList</span>, $<span style="color: #dcaeea;">activeEntryNum</span> + <span style="color: #da8548; font-weight: bold;">1</span>;
        }
    }
}

<span style="color: #51afef;">sub</span> <span style="color: #c678dd;">updateJumpListBasedOnFocus</span> {
    <span style="color: #51afef;">my</span> ($<span style="color: #dcaeea;">keepLaterEntriesIfAdding</span>) = @<span style="color: #dcaeea; text-decoration: underline;">_</span>;

    <span style="color: #51afef;">my</span> $<span style="color: #dcaeea;">doAddEntry</span> = <span style="color: #da8548; font-weight: bold;">0</span>;
    <span style="color: #51afef;">if</span> (@<span style="color: #dcaeea; text-decoration: underline;">currentJumpList</span>) {
        <span style="color: #5B6268;"># if we have moved away from the active jump list entry, then add this to the top of the jump list</span>
        <span style="color: #51afef;">my</span> ($<span style="color: #dcaeea;">activeEntryDesktop</span>, $<span style="color: #dcaeea;">activeEntryWindow</span>) = @{ $<span style="color: #dcaeea;">currentJumpList</span>[$<span style="color: #dcaeea;">activeEntryNum</span>] };

        <span style="color: #51afef;">my</span> $<span style="color: #dcaeea;">sameWindow</span> = $<span style="color: #dcaeea;">activeEntryWindow</span> eq $<span style="color: #dcaeea;">focusedWindow</span>;
        <span style="color: #51afef;">my</span> $<span style="color: #dcaeea;">sameDesktop</span> = $<span style="color: #dcaeea;">activeEntryDesktop</span> eq $<span style="color: #dcaeea;">currentDesktop</span>;
        <span style="color: #51afef;">if</span> ($<span style="color: #dcaeea;">sameWindow</span> &amp;&amp; not $<span style="color: #dcaeea;">sameDesktop</span>) {
            <span style="color: #5B6268;"># if we are focused on the current window, then overwrite the entry's desktop</span>
            $<span style="color: #dcaeea;">currentJumpList</span>[$<span style="color: #dcaeea;">activeEntryNum</span>][<span style="color: #da8548; font-weight: bold;">0</span>] = $<span style="color: #dcaeea;">currentDesktop</span>;
        } <span style="color: #51afef;">elsif</span> ($<span style="color: #dcaeea;">sameDesktop</span>) {
            <span style="color: #5B6268;"># then, just update the window instead of making a whole new entry</span>
            $<span style="color: #dcaeea;">currentJumpList</span>[$<span style="color: #dcaeea;">activeEntryNum</span>][<span style="color: #da8548; font-weight: bold;">1</span>] = $<span style="color: #dcaeea;">focusedWindow</span>;
        } <span style="color: #51afef;">else</span> {
            $<span style="color: #dcaeea;">doAddEntry</span> = <span style="color: #da8548; font-weight: bold;">1</span>;
        }
    } <span style="color: #51afef;">else</span> {
        $<span style="color: #dcaeea;">doAddEntry</span> = <span style="color: #da8548; font-weight: bold;">1</span>;
    }

    <span style="color: #51afef;">if</span> ($<span style="color: #dcaeea;">doAddEntry</span>) {
        <span style="color: #5B6268;"># (different window, different desktop)</span>
        addJumpEntry $<span style="color: #dcaeea;">keepLaterEntriesIfAdding</span>;

        <span style="color: #5B6268;"># if offset is negative, then we need to skip past the entry we just created;</span>
        <span style="color: #5B6268;"># ACTUALLY, our current desired behavior is that if we go backwards and we aren't on the active entry, it will go to the active entry</span>
        <span style="color: #5B6268;"># if ($offset &lt; 0) {</span>
        <span style="color: #5B6268;">#     $offset -= 1;</span>
        <span style="color: #5B6268;"># }</span>
    }
}

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">this function takes in an offset, and modifies the count accordingly</span>
<span style="color: #51afef;">sub</span> <span style="color: #c678dd;">shiftStackPointer</span> {
    <span style="color: #51afef;">my</span> ($<span style="color: #dcaeea;">offset</span>) = @<span style="color: #dcaeea; text-decoration: underline;">_</span>;

    updateJumpListBasedOnFocus <span style="color: #da8548; font-weight: bold;">1</span>;

    $<span style="color: #dcaeea;">activeEntryNum</span> += $<span style="color: #dcaeea;">offset</span>;

    <span style="color: #5B6268;"># MISTAKE: when given only one argument, it will treat the argument as the /pattern/, and use $_ as the expression to split.</span>
    <span style="color: #51afef;">my</span> ($<span style="color: #dcaeea;">desktop</span>, $<span style="color: #dcaeea;">window</span>) = @{ ($<span style="color: #dcaeea;">currentJumpList</span>[$<span style="color: #dcaeea;">activeEntryNum</span>]) };

    <span style="color: #5B6268;"># now, let's switch the window</span>
    <span style="color: #51afef;">my</span> $<span style="color: #dcaeea;">exitCode</span> = system(<span style="color: #98be65;">"wmctrl -ia $window"</span>);

    <span style="color: #51afef;">if</span> ($<span style="color: #dcaeea;">exitCode</span> eq <span style="color: #da8548; font-weight: bold;">0</span>) {
        <span style="color: #5B6268;"># move cursor to center of window</span>
        push @<span style="color: #dcaeea; text-decoration: underline;">commandQueue</span>, <span style="color: #98be65;">"xdotool mousemove --window $window --sync --polar 0 0"</span>;

        <span style="color: #5B6268;"># trackmouse flash</span>
        <span style="color: #51afef;">my</span> $<span style="color: #dcaeea;">toggleTrackMouse</span> = <span style="color: #98be65;">"qdbus org.kde.kglobalaccel /component/kwin org.kde.kglobalaccel.Component.invokeShortcut TrackMouse"</span>;
        push @<span style="color: #dcaeea; text-decoration: underline;">commandQueue</span>, $<span style="color: #dcaeea;">toggleTrackMouse</span>;
        push @<span style="color: #dcaeea; text-decoration: underline;">commandQueue</span>, <span style="color: #98be65;">"sleep 0.50"</span>;
        push @<span style="color: #dcaeea; text-decoration: underline;">commandQueue</span>, $<span style="color: #dcaeea;">toggleTrackMouse</span>;
    } <span style="color: #51afef;">else</span> {
        <span style="color: #5B6268;"># </span><span style="color: #ECBE7B; font-weight: bold;">TODO:</span><span style="color: #5B6268;"> focus correct monitor</span>
        system(<span style="color: #98be65;">"wmctrl -s $desktop"</span>);
    }
}

<span style="color: #51afef;">sub</span> <span style="color: #c678dd;">prevEntry</span> {
    updateJumpListBasedOnFocus <span style="color: #da8548; font-weight: bold;">1</span>;

    <span style="color: #51afef;">if</span> ($<span style="color: #dcaeea;">activeEntryNum</span> &gt; <span style="color: #da8548; font-weight: bold;">0</span>) {
        shiftStackPointer -<span style="color: #da8548; font-weight: bold;">1</span>;
    } <span style="color: #51afef;">else</span> {
        print STDERR <span style="color: #98be65;">"No previous entry!"</span>;
        <span style="color: #51afef;">exit</span> <span style="color: #da8548; font-weight: bold;">1</span>;
    }
}

<span style="color: #51afef;">sub</span> <span style="color: #c678dd;">nextEntry</span> {
    <span style="color: #51afef;">if</span> ($<span style="color: #dcaeea;">activeEntryNum</span> &lt; $#<span style="color: #dcaeea; text-decoration: underline;">currentJumpList</span>) {
        shiftStackPointer <span style="color: #da8548; font-weight: bold;">1</span>;
    } <span style="color: #51afef;">else</span> {
        print STDERR <span style="color: #98be65;">"No next entry!"</span>;
        <span style="color: #51afef;">exit</span> <span style="color: #da8548; font-weight: bold;">1</span>;
    }
}

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">now, let's do a dispatch list</span>
<span style="color: #51afef;">for</span> ($<span style="color: #dcaeea;">ARGV</span>[<span style="color: #da8548; font-weight: bold;">0</span>]) {
    <span style="color: #98be65;">/add-replace/</span> &amp;&amp; <span style="color: #51afef;">do</span> { updateJumpListBasedOnFocus <span style="color: #da8548; font-weight: bold;">0</span>; <span style="color: #51afef;">last</span> };
    <span style="color: #98be65;">/add-shift/</span> &amp;&amp; <span style="color: #51afef;">do</span> { updateJumpListBasedOnFocus <span style="color: #da8548; font-weight: bold;">1</span>; <span style="color: #51afef;">last</span> };
    <span style="color: #98be65;">/next/</span> &amp;&amp; <span style="color: #51afef;">do</span> { nextEntry; <span style="color: #51afef;">last</span> };
    <span style="color: #98be65;">/prev/</span> &amp;&amp; <span style="color: #51afef;">do</span> { prevEntry; <span style="color: #51afef;">last</span> };

    print STDERR <span style="color: #98be65;">"Please specify 'add-replace', 'add-shift', 'next', or 'prev' as the first argument; received $ARGV[0]"</span>;
    <span style="color: #51afef;">exit</span> <span style="color: #da8548; font-weight: bold;">1</span>;
}

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">if empty, then we did not add any entries</span>
<span style="color: #51afef;">if</span> (@<span style="color: #dcaeea; text-decoration: underline;">currentJumpList</span>) {
    <span style="color: #5B6268;"># now, let's yield the new jump list</span>
    open FH, <span style="color: #98be65;">"&gt;"</span>, $<span style="color: #dcaeea;">jumpListPath</span>;
    print FH $<span style="color: #dcaeea;">activeEntryNum</span>;
    print FH <span style="color: #98be65;">"\n"</span>;
    print FH join(<span style="color: #98be65;">"\n"</span>, map { join(<span style="color: #98be65;">" "</span>, @{$<span style="color: #dcaeea;">_</span>}) } @<span style="color: #dcaeea; text-decoration: underline;">currentJumpList</span>);
    close FH;

    <span style="color: #51afef;">for</span> (@<span style="color: #dcaeea; text-decoration: underline;">commandQueue</span>) {
        system($<span style="color: #dcaeea;">_</span>);
    }
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgbc2f631" class="outline-3">
<h3 id="orgbc2f631"><span class="section-number-3">1.14.</span> <a href="#coderef-window-switcher" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-window-switcher');" onmouseout="CodeHighlightOff(this, 'coderef-window-switcher');">Window Switcher</a></h3>
<div class="outline-text-3" id="text-1-14">
<p>
Opens the Window Switcher
</p>

<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">window-switcher</span>]
[[<span style="color: #ECBE7B;">private</span>]]
<span style="color: #dcaeea;">rofi-args</span> = <span style="color: #98be65;">"-noplugins -lines 5 --normal-window -sort -sorting-method fzf -monitor -4 -matching fuzzy -modi window -show window"</span>

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">note that in Posix SH, &amp; acts as a separator between commands, and a semicolon</span>
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">after it is invalid syntax.</span>
<span style="color: #dcaeea;">mark-and-jump-command</span> = <span style="color: #98be65;">"$jump-list-mark &amp; sleep 0.15; wmctrl -ia {window}"</span>
<span style="color: #dcaeea;">jump-to-window</span> = (cmd-button <span style="color: #98be65;">"$ROFI $rofi-args -window-command \"/bin/dash -c '$mark-and-jump-command'\" -kb-accept-entry '' -kb-accept-alt 'Return'"</span>)
<span style="color: #dcaeea;">pull-window</span> = (cmd-button <span style="color: #98be65;">"$ROFI $rofi-args -window-command 'wmctrl -iR {window}' -kb-accept-entry '' -kb-accept-alt 'Return'"</span>)
[[<span style="color: #ECBE7B;">public</span>]]
<span style="color: #dcaeea;">activate</span> = (tap-hold $tap-hold-delay-min @jump-to-window @pull-window)
</pre>
</div>

<p>
I made this into a layer purely for organizational purposes.
When tapped, <code>activate</code> will yield a Rofi window switcher which will switch to the selected window.
When held, <code>activate</code> will yield a Rofi window switcher which will move the selected window to the current desktop before selecting it.
</p>

<p>
I compiled <code>rofi</code> from source and put it in <code>~/.local/bin</code> because the RPM version was too slow for my taste.
Some of the flags are also there for optimization reasons: <code>-modi</code>, <code>-noplugins</code> and <code>--normal-window</code>.
I noticed that the startup animation was faster with <code>--normal-window</code>, and the other 2 flags stop <code>rofi</code> from doing unnecessary work.
<code>-matching fuzzy</code> makes it use fuzzy matching instead of only matching the raw string.
<code>-sort</code> and <code>-sorting-method fzf</code> make the selections a lot more intelligent.
<code>-monitor -4</code> makes it open <code>rofi</code> on the monitor of the currently focused window.
</p>
</div>
</div>
<div id="outline-container-org728d4b4" class="outline-3">
<h3 id="org728d4b4"><span class="section-number-3">1.15.</span> <a href="#coderef-discord" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-discord');" onmouseout="CodeHighlightOff(this, 'coderef-discord');">Discord</a></h3>
<div class="outline-text-3" id="text-1-15">
<p>
This command uses <code>wmctrl</code> to switch to a currently-existing Discord window, and if it fails opens a new instance of Discord.
</p>

<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">aliases</span>]
<span style="color: #dcaeea;">DISCORD_SCRIPT</span> = <span style="color: #98be65;">"~/.config/kmonad/discord/discord.sh"</span>
<span style="color: #dcaeea;">discord</span> = (cmd-button <span style="color: #98be65;">"$DISCORD_SCRIPT"</span>)
</pre>
</div>
</div>
<div id="outline-container-org4620fc5" class="outline-4">
<h4 id="org4620fc5"><span class="section-number-4">1.15.1.</span> <span class="todo TODO">TODO</span> Switch back to the previous window when invoked a second time</h4>
</div>
</div>
<div id="outline-container-orgcd40a99" class="outline-3">
<h3 id="orgcd40a99"><span class="section-number-3">1.16.</span> <a href="#coderef-emacs" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-emacs');" onmouseout="CodeHighlightOff(this, 'coderef-emacs');">Emacs</a></h3>
<div class="outline-text-3" id="text-1-16">
<p>
Opens Emacs: <code>emacsclient</code> on tap, <code>emacs</code> process on hold.
</p>

<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">aliases</span>]
<span style="color: #dcaeea;">emacs</span> = (tap-hold $tap-hold-delay-min (cmd-button <span style="color: #98be65;">"$EMACSCLIENT --create-frame"</span>) (cmd-button <span style="color: #98be65;">"$EMACS"</span>))
</pre>
</div>
</div>
</div>
<div id="outline-container-org57c0a79" class="outline-3">
<h3 id="org57c0a79"><span class="section-number-3">1.17.</span> <a href="#coderef-firefox" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-firefox');" onmouseout="CodeHighlightOff(this, 'coderef-firefox');">Firefox</a></h3>
<div class="outline-text-3" id="text-1-17">
<p>
Opens a new Firefox window
</p>

<dl class="org-dl">
<dt><code>FIREFOX_TAB_SWITCHER_SCRIPT</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="orgc4fa895">~/.config/kmonad/firefox/firefox_tab_switcher.sh
</pre>
</div></dd>
</dl>

<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">aliases</span>]
<span style="color: #dcaeea;">FIREFOX_TAB_SWITCHER_SCRIPT</span> = <span style="color: #98be65;">"|&gt;FIREFOX_TAB_SWITCHER_SCRIPT&lt;|"</span>

<span style="color: #dcaeea;">open_firefox</span> = (cmd-button <span style="color: #98be65;">"firefox"</span>)
<span style="color: #dcaeea;">select_firefox_tab</span> = (cmd-button <span style="color: #98be65;">"$FIREFOX_TAB_SWITCHER_SCRIPT"</span>)

<span style="color: #dcaeea;">firefox_composite</span> = (tap-hold <span style="color: #da8548; font-weight: bold;">135</span> @open_firefox @select_firefox_tab)
</pre>
</div>
</div>
<div id="outline-container-org695a6d9" class="outline-4">
<h4 id="org695a6d9"><span class="section-number-4">1.17.1.</span> Firefox Tab Switcher</h4>
<div class="outline-text-4" id="text-1-17-1">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #5B6268;">#</span><span style="color: #5B6268;">!/bin/</span><span style="color: #51afef;">sh</span>

<span style="color: #dcaeea;">IFS</span>=<span style="color: #98be65;">"</span>
<span style="color: #98be65;">"</span>

<span style="color: #dcaeea;">tabs</span>=$<span style="color: #51afef;">(</span>|&gt;BROTAB&lt;| list<span style="color: #51afef;">)</span>

<span style="color: #ECBE7B;">echo</span> <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">tabs</span><span style="color: #98be65;">"</span> &gt; /tmp/kmonadtabs

<span style="color: #dcaeea;">selected</span>=$<span style="color: #51afef;">(</span><span style="color: #ECBE7B;">echo</span> <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">tabs</span><span style="color: #98be65;">"</span> | awk -F <span style="color: #98be65;">'\t'</span> <span style="color: #98be65;">'{print $2}'</span> | rofi -noplugins -dmenu -i -lines <span style="color: #da8548; font-weight: bold;">8</span> --normal-window -matching fuzzy -format <span style="color: #98be65;">'d'</span><span style="color: #51afef;">)</span>

<span style="color: #dcaeea;">selection</span>=$<span style="color: #51afef;">(</span><span style="color: #ECBE7B;">echo</span> <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">tabs</span><span style="color: #98be65;">"</span> | tail -n <span style="color: #98be65;">"+</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">selected</span><span style="color: #98be65;">"</span> | head -n <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span>

<span style="color: #dcaeea;">activation</span>=<span style="color: #98be65;">"</span><span style="color: #51afef; font-weight: bold;">$(</span><span style="color: #51afef; font-weight: bold;">echo</span><span style="color: #51afef; font-weight: bold;"> "</span><span style="color: #51afef; font-weight: bold;">$</span><span style="color: #51afef; font-weight: bold;">selection</span><span style="color: #51afef; font-weight: bold;">" | awk -F '\t' '{print </span><span style="color: #51afef; font-weight: bold;">$</span><span style="color: #51afef; font-weight: bold;">1</span><span style="color: #51afef; font-weight: bold;">}')</span><span style="color: #98be65;">"</span>
|&gt;BROTAB&lt;| activate <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">activation</span><span style="color: #98be65;">"</span>

<span style="color: #dcaeea;">title</span>=<span style="color: #98be65;">"</span><span style="color: #51afef; font-weight: bold;">$(</span><span style="color: #51afef; font-weight: bold;">echo</span><span style="color: #51afef; font-weight: bold;"> "</span><span style="color: #51afef; font-weight: bold;">$</span><span style="color: #51afef; font-weight: bold;">selection</span><span style="color: #51afef; font-weight: bold;">" | awk -F '\t' '{print </span><span style="color: #51afef; font-weight: bold;">$</span><span style="color: #51afef; font-weight: bold;">2</span><span style="color: #51afef; font-weight: bold;">}')</span><span style="color: #98be65;">"</span>
wmctrl -a <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">title</span><span style="color: #98be65;">"</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc2ac15e" class="outline-3">
<h3 id="orgc2ac15e"><span class="section-number-3">1.18.</span> <a href="#coderef-brightness" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-brightness');" onmouseout="CodeHighlightOff(this, 'coderef-brightness');">Brightness</a></h3>
<div class="outline-text-3" id="text-1-18">
<dl class="org-dl">
<dt><code>CHANGE_BRIGHTNESS_SCRIPT</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="org48d53db">~/.config/kmonad/brightness/change_brightness.sh
</pre>
</div></dd>
<dt>CHANGE_BACKLIGHT_SCRIPT</dt><dd><div class="org-src-container">
<pre class="src src-text" id="org9e52a02">~/.config/kmonad/brightness/change_backlight.sh
</pre>
</div></dd>
<dt><code>QUEUE_DIGIT_SCRIPT</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="org53cad29">~/.config/kmonad/brightness/queue_digit.sh
</pre>
</div></dd>
<dt><code>DIGIT_QUEUE_FILE</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="orgcdecfd4">/tmp/kmonad_digit_queue
</pre>
</div></dd>
<dt><code>LAST_BRIGHTNESS_CHANGE_FILE</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="org5b05652">/tmp/kmonad_last_brightness_change
</pre>
</div></dd>
</dl>

<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">brightness</span>]
[[<span style="color: #ECBE7B;">private</span>]]
<span style="color: #dcaeea;">QUEUE_DIGIT_SCRIPT</span> = <span style="color: #98be65;">"|&gt;QUEUE_DIGIT_SCRIPT&lt;|"</span>
<span style="color: #dcaeea;">CHANGE_BRIGHTNESS_SCRIPT</span> = <span style="color: #98be65;">"|&gt;CHANGE_BRIGHTNESS_SCRIPT&lt;|"</span>
<span style="color: #dcaeea;">CHANGE_BACKLIGHT_SCRIPT</span> = <span style="color: #98be65;">"|&gt;CHANGE_BACKLIGHT_SCRIPT&lt;|"</span>

<span style="color: #dcaeea;">exit_internal</span> = (layer-rem brightness)
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">the definition for `exit` is generated by our preprocessing script</span>
[[<span style="color: #ECBE7B;">public</span>]]
<span style="color: #dcaeea;">enter</span> = (tap-hold-next-release $tap-hold-delay <span style="color: #5B6268;">#</span><span style="color: #5B6268;">((layer-add brightness) @kbd-set-backlight-on) (layer-toggle brightness))</span>

<span style="color: #dcaeea;">up</span> = (tap-hold-next-release $tap-hold-delay-min (cmd-button <span style="color: #98be65;">"$CHANGE_BRIGHTNESS_SCRIPT +"</span>) (cmd-button <span style="color: #98be65;">"$CHANGE_BACKLIGHT_SCRIPT +"</span>))
<span style="color: #dcaeea;">down</span> = (tap-hold-next-release $tap-hold-delay-min (cmd-button <span style="color: #98be65;">"$CHANGE_BRIGHTNESS_SCRIPT -"</span>) (cmd-button <span style="color: #98be65;">"$CHANGE_BACKLIGHT_SCRIPT -"</span>))

<span style="color: #dcaeea;">toggle_nightlight</span> = (cmd-button <span style="color: #98be65;">"$CHANGE_BRIGHTNESS_SCRIPT '*'"</span>)
[[<span style="color: #ECBE7B;">keys</span>]]
</pre>
</div>

<p>
This is repetitive, so let&rsquo;s abstract it away by generating the code with Python.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #51afef;">return</span> <span style="color: #98be65;">'</span><span style="color: #a9a1e1;">\n</span><span style="color: #98be65;">'</span>.join(<span style="color: #c678dd;">map</span>(<span style="color: #51afef;">lambda</span> n: f<span style="color: #98be65;">'</span>{n}<span style="color: #98be65;"> = (cmd-button "$QUEUE_DIGIT_SCRIPT </span>{n}<span style="color: #98be65;">")'</span>, <span style="color: #c678dd;">range</span>(<span style="color: #da8548; font-weight: bold;">0</span>, <span style="color: #da8548; font-weight: bold;">10</span>)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kbdx"><span style="color: #da8548; font-weight: bold;">0</span> = (cmd-button <span style="color: #98be65;">"$QUEUE_DIGIT_SCRIPT 0"</span>)
<span style="color: #da8548; font-weight: bold;">1</span> = (cmd-button <span style="color: #98be65;">"$QUEUE_DIGIT_SCRIPT 1"</span>)
<span style="color: #da8548; font-weight: bold;">2</span> = (cmd-button <span style="color: #98be65;">"$QUEUE_DIGIT_SCRIPT 2"</span>)
<span style="color: #da8548; font-weight: bold;">3</span> = (cmd-button <span style="color: #98be65;">"$QUEUE_DIGIT_SCRIPT 3"</span>)
<span style="color: #da8548; font-weight: bold;">4</span> = (cmd-button <span style="color: #98be65;">"$QUEUE_DIGIT_SCRIPT 4"</span>)
<span style="color: #da8548; font-weight: bold;">5</span> = (cmd-button <span style="color: #98be65;">"$QUEUE_DIGIT_SCRIPT 5"</span>)
<span style="color: #da8548; font-weight: bold;">6</span> = (cmd-button <span style="color: #98be65;">"$QUEUE_DIGIT_SCRIPT 6"</span>)
<span style="color: #da8548; font-weight: bold;">7</span> = (cmd-button <span style="color: #98be65;">"$QUEUE_DIGIT_SCRIPT 7"</span>)
<span style="color: #da8548; font-weight: bold;">8</span> = (cmd-button <span style="color: #98be65;">"$QUEUE_DIGIT_SCRIPT 8"</span>)
<span style="color: #da8548; font-weight: bold;">9</span> = (cmd-button <span style="color: #98be65;">"$QUEUE_DIGIT_SCRIPT 9"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kbdx"><span style="color: #dcaeea;">k</span> = up
<span style="color: #dcaeea;">j</span> = down

<span style="color: #dcaeea;">h</span> = toggle_nightlight

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">q displays brightness on each monitor</span>

<span style="color: #dcaeea;">tab</span> = switch_focus_composite

<span style="color: #dcaeea;">lmet</span> = exit
</pre>
</div>
</div>
<div id="outline-container-org3a59c1e" class="outline-4">
<h4 id="org3a59c1e"><span class="section-number-4">1.18.1.</span> Queue Digit Script</h4>
<div class="outline-text-4" id="text-1-18-1">
<p>
This script takes a digit and appends it to the queue of currently waiting digits. The change brightness script consumes the queue as a single integer.
</p>

<p>
Using <code>dash</code> shell for speed
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #5B6268;">#</span><span style="color: #5B6268;">!/bin/</span><span style="color: #51afef;">dash</span>

<span style="color: #dcaeea;">FILE</span>=<span style="color: #98be65;">"|&gt;DIGIT_QUEUE_FILE&lt;|"</span>
</pre>
</div>

<p>
Verify that the argument is a number by using <code>case</code> and globbing.
See <a href="https://stackoverflow.com/questions/806906/how-do-i-test-if-a-variable-is-a-number-in-bash/806923">https://stackoverflow.com/questions/806906/how-do-i-test-if-a-variable-is-a-number-in-bash/806923</a>(this) StackOverflow post.
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #dcaeea;">DIGIT</span>=$<span style="color: #da8548; font-weight: bold;">1</span>

<span style="color: #51afef;">case</span> $<span style="color: #dcaeea;">DIGIT</span><span style="color: #51afef;"> in</span>
<span style="color: #98be65;">''</span> | *<span style="color: #51afef;">[</span><span style="color: #51afef; font-weight: bold;">!</span>0-9<span style="color: #51afef;">]</span>*) <span style="color: #ECBE7B;">echo</span> <span style="color: #98be65;">"Need to pass in a number!"</span> &gt;/dev/stderr; <span style="color: #51afef;">exit</span> <span style="color: #da8548; font-weight: bold;">1</span>;;
*) ;;
<span style="color: #51afef;">esac</span>
</pre>
</div>

<p>
Next, read the current file contents, prepend it to <code>DIGIT</code>, and then write it back.
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #5B6268;"># </span><span style="color: #5B6268;">read file</span>
<span style="color: #51afef;">if</span> <span style="color: #51afef;">[</span> -e <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">FILE</span><span style="color: #98be65;">"</span> <span style="color: #51afef;">]</span>; <span style="color: #51afef;">then</span>
    <span style="color: #dcaeea;">CURRENT_INT</span>=$<span style="color: #51afef;">(</span><span style="color: #ECBE7B;">cat</span> <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">FILE</span><span style="color: #98be65;">"</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">fi</span>

<span style="color: #dcaeea;">NEW_INT</span>=<span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">CURRENT_INT</span><span style="color: #98be65;">$DIGIT"</span>

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">also print it to stdout; helpful for debugging</span>
<span style="color: #ECBE7B;">echo</span> <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">NEW_INT</span><span style="color: #98be65;">"</span> | tee <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">FILE</span><span style="color: #98be65;">"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org9345db3" class="outline-4">
<h4 id="org9345db3"><span class="section-number-4">1.18.2.</span> Change Brightness Script</h4>
<div class="outline-text-4" id="text-1-18-2">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #5B6268;">#</span><span style="color: #5B6268;">!/bin/</span><span style="color: #51afef;">dash</span>

<span style="color: #dcaeea;">DIGIT_FILE</span>=<span style="color: #98be65;">"|&gt;DIGIT_QUEUE_FILE&lt;|"</span>
<span style="color: #dcaeea;">LAST_BRIGHTNESS_CHANGE_FILE</span>=<span style="color: #98be65;">"|&gt;LAST_BRIGHTNESS_CHANGE_FILE&lt;|"</span>

<span style="color: #dcaeea;">DIRECTION</span>=$<span style="color: #da8548; font-weight: bold;">1</span>
</pre>
</div>

<p>
Depending on <code>DIRECTION</code>, set <code>SIGN</code> to the sign. There&rsquo;s a special case for <code>.</code>; with <code>.</code>, <code>SIGN</code> becomes zero and triggers special behavior further on.
</p>
<div class="org-src-container">
<pre class="src src-sh">
<span style="color: #51afef;">case</span> $<span style="color: #dcaeea;">DIRECTION</span><span style="color: #51afef;"> in</span>
<span style="color: #98be65;">'+'</span>) <span style="color: #dcaeea;">SIGN</span>=<span style="color: #da8548; font-weight: bold;">1</span> ;;
<span style="color: #98be65;">'-'</span>) <span style="color: #dcaeea;">SIGN</span>=-1 ;;
<span style="color: #98be65;">'.'</span>) ;;
<span style="color: #98be65;">'*'</span>) ;;
*)
    <span style="color: #ECBE7B;">echo</span> <span style="color: #98be65;">"Invalid direction"</span> &gt;/dev/stderr
    <span style="color: #51afef;">exit</span> <span style="color: #da8548; font-weight: bold;">1</span>
    ;;
<span style="color: #51afef;">esac</span>
</pre>
</div>

<p>
We preset <code>CHANGE</code> so that any code path which never sets <code>CHANGE</code> will use the value of <code>7</code>.
</p>
<div class="org-src-container">
<pre class="src src-sh">
<span style="color: #dcaeea;">CHANGE</span>=<span style="color: #da8548; font-weight: bold;">7</span>
</pre>
</div>

<p>
In the normal case, check if there are queued digits, and if there aren&rsquo;t then default to <code>7</code>.
After reading the saved digits, clear the file&rsquo;s contents.
</p>
<div class="org-src-container">
<pre class="src src-sh">
<span style="color: #51afef;">if</span> <span style="color: #51afef;">[</span> <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">DIRECTION</span><span style="color: #98be65;">"</span> != <span style="color: #98be65;">'.'</span> <span style="color: #51afef;">]</span> &amp;&amp; <span style="color: #51afef;">[</span> <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">DIRECTION</span><span style="color: #98be65;">"</span> != <span style="color: #98be65;">'*'</span> <span style="color: #51afef;">]</span>; <span style="color: #51afef;">then</span>
    <span style="color: #dcaeea;">QUEUED_DIGITS</span>=$<span style="color: #51afef;">(</span><span style="color: #ECBE7B;">cat</span> <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">DIGIT_FILE</span><span style="color: #98be65;">"</span> <span style="color: #da8548; font-weight: bold;">2</span>&gt;/dev/null<span style="color: #51afef;">)</span>

    <span style="color: #51afef;">if</span> <span style="color: #51afef;">[</span> -n <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">QUEUED_DIGITS</span><span style="color: #98be65;">"</span> <span style="color: #51afef;">]</span>; <span style="color: #51afef;">then</span>
        <span style="color: #51afef;">if</span> <span style="color: #51afef;">[</span> <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">QUEUED_DIGITS</span><span style="color: #98be65;">"</span> -ge <span style="color: #da8548; font-weight: bold;">100</span> <span style="color: #51afef;">]</span>; <span style="color: #51afef;">then</span>
            <span style="color: #dcaeea;">QUEUED_DIGITS</span>=<span style="color: #da8548; font-weight: bold;">100</span>
        <span style="color: #51afef;">fi</span>

        <span style="color: #ECBE7B;">echo</span> <span style="color: #98be65;">""</span> &gt;<span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">DIGIT_FILE</span><span style="color: #98be65;">"</span>
        <span style="color: #dcaeea;">CHANGE</span>=$<span style="color: #dcaeea;">QUEUED_DIGITS</span>
    <span style="color: #51afef;">fi</span>
</pre>
</div>

<p>
To get the final value for <code>CHANGE</code>, multiply <code>SIGN</code> by its current value.
Then, write the new value to <code>LAST_BRIGHTNESS_CHANGE_FILE</code>.
</p>
<div class="org-src-container">
<pre class="src src-sh">
    <span style="color: #dcaeea;">CHANGE</span>=$<span style="color: #51afef;">(</span><span style="color: #ECBE7B;">echo</span> <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">SIGN</span><span style="color: #98be65;"> * </span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">CHANGE</span><span style="color: #98be65;">"</span> | bc<span style="color: #51afef;">)</span>
    <span style="color: #ECBE7B;">echo</span> <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">CHANGE</span><span style="color: #98be65;">"</span> &gt;<span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">LAST_BRIGHTNESS_CHANGE_FILE</span><span style="color: #98be65;">"</span>
</pre>
</div>

<p>
If <code>DIRECTION</code> <i>is</i> <code>.</code>, then read <code>CHANGE</code> directly from <code>LAST_BRIGHTNESS_CHANGE_FILE</code>. If it doesn&rsquo;t exist, then fail.
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #51afef;">else</span>
    <span style="color: #51afef;">if</span> <span style="color: #51afef;">[</span> <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">DIRECTION</span><span style="color: #98be65;">"</span> = <span style="color: #98be65;">"."</span> <span style="color: #51afef;">]</span>; <span style="color: #51afef;">then</span>
        <span style="color: #51afef;">if</span> <span style="color: #51afef;">[</span> -e <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">LAST_BRIGHTNESS_CHANGE_FILE</span><span style="color: #98be65;">"</span> <span style="color: #51afef;">]</span>; <span style="color: #51afef;">then</span>
            <span style="color: #dcaeea;">CHANGE</span>=$<span style="color: #51afef;">(</span><span style="color: #ECBE7B;">cat</span> <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">LAST_BRIGHTNESS_CHANGE_FILE</span><span style="color: #98be65;">"</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">else</span>
            <span style="color: #ECBE7B;">echo</span> <span style="color: #98be65;">"Last brightness change file does not yet exist!"</span> &gt;/dev/stderr
            <span style="color: #51afef;">exit</span> <span style="color: #da8548; font-weight: bold;">1</span>
        <span style="color: #51afef;">fi</span>
</pre>
</div>

<p>
Otherwise, it is <code>*</code>, which means that we want to toggle the nightlight.
In this case, we call a different script for toggling the nightlight on the actively focused monitor.
We exit the script afterwards so that we don&rsquo;t end up calling the standard <code>changeBrightness</code> script next.
</p>
<div class="org-src-container">
<pre class="src src-sh">    <span style="color: #51afef;">else</span>
        /home/sridaran/Development/Scripts/DE/toggleNightlight.sh
        <span style="color: #51afef;">exit</span> <span style="color: #da8548; font-weight: bold;">0</span>
    <span style="color: #51afef;">fi</span>
<span style="color: #51afef;">fi</span>
</pre>
</div>

<p>
Finally, pass <code>CHANGE</code> to our main <code>changeBrightness</code> script (not shown), which changes the brightness on the actively focused monitor.
</p>
<div class="org-src-container">
<pre class="src src-sh">
/home/sridaran/Development/Scripts/DE/changeBrightness.sh <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">CHANGE</span><span style="color: #98be65;">"</span> -n
</pre>
</div>
</div>
</div>
<div id="outline-container-org866d694" class="outline-4">
<h4 id="org866d694"><span class="section-number-4">1.18.3.</span> Change Backlight Script</h4>
<div class="outline-text-4" id="text-1-18-3">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #5B6268;">#</span><span style="color: #5B6268;">!/bin/</span><span style="color: #51afef;">dash</span>

<span style="color: #51afef;">case</span> $<span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;"> in</span>
    <span style="color: #98be65;">"+"</span>) <span style="color: #dcaeea;">DIR</span>=+
         ;;
    <span style="color: #98be65;">"-"</span>) <span style="color: #dcaeea;">DIR</span>=-
         ;;
    *)
        <span style="color: #ECBE7B;">echo</span> <span style="color: #98be65;">"Please specify + or - as direction!"</span> &gt; /dev/stderr
        <span style="color: #51afef;">exit</span> <span style="color: #da8548; font-weight: bold;">1</span>
        ;;
<span style="color: #51afef;">esac</span>

<span style="color: #dcaeea;">current_brightness</span>=$<span style="color: #51afef;">(</span>qdbus org.kde.Solid.PowerManagement /org/kde/Solid/PowerManagement/Actions/BrightnessControl org.kde.Solid.PowerManagement.Actions.BrightnessControl.brightness<span style="color: #51afef;">)</span>
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">source: https://userbase.kde.org/KDE_Connect/Tutorials/Useful_commands#Brightness_settings</span>
<span style="color: #dcaeea;">new_brightness</span>=$<span style="color: #51afef;">(</span>expr $<span style="color: #dcaeea;">current_brightness</span> $<span style="color: #dcaeea;">DIR</span> <span style="color: #da8548; font-weight: bold;">375</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">for some reason, the setBrightness interface allows you to go out of bounds,</span>
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">so we clamp it manually.</span>
<span style="color: #51afef;">if</span> <span style="color: #51afef;">[</span> $<span style="color: #dcaeea;">new_brightness</span> -lt <span style="color: #da8548; font-weight: bold;">1</span> <span style="color: #51afef;">]</span>; <span style="color: #51afef;">then</span>
    <span style="color: #dcaeea;">new_brightness</span>=<span style="color: #da8548; font-weight: bold;">1</span>
<span style="color: #51afef;">elif</span> <span style="color: #51afef;">[</span> $<span style="color: #dcaeea;">new_brightness</span> -gt <span style="color: #da8548; font-weight: bold;">7500</span> <span style="color: #51afef;">]</span>; <span style="color: #51afef;">then</span>
    <span style="color: #dcaeea;">new_brightness</span>=<span style="color: #da8548; font-weight: bold;">7500</span>
<span style="color: #51afef;">fi</span>

qdbus org.kde.Solid.PowerManagement /org/kde/Solid/PowerManagement/Actions/BrightnessControl org.kde.Solid.PowerManagement.Actions.BrightnessControl.setBrightness $<span style="color: #dcaeea;">new_brightness</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org3a4f1ba" class="outline-3">
<h3 id="org3a4f1ba"><span class="section-number-3">1.19.</span> <span class="todo TODO">TODO</span> <a href="#coderef-terminal" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-terminal');" onmouseout="CodeHighlightOff(this, 'coderef-terminal');">Terminal</a></h3>
</div>
<div id="outline-container-orge7082ab" class="outline-3">
<h3 id="orge7082ab"><span class="section-number-3">1.20.</span> <a href="#coderef-run" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-run');" onmouseout="CodeHighlightOff(this, 'coderef-run');">Run</a></h3>
<div class="outline-text-3" id="text-1-20">
<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">run</span>]
[[<span style="color: #ECBE7B;">private</span>]]
<span style="color: #dcaeea;">runner_script</span> = <span style="color: #98be65;">"~/.config/kmonad/runner/runner.sh"</span>
<span style="color: #dcaeea;">toggle</span> = (cmd-button <span style="color: #98be65;">"$runner_script toggle"</span>)
<span style="color: #dcaeea;">dwim</span> = (cmd-button <span style="color: #98be65;">"$runner_script dwim"</span>)
[[<span style="color: #ECBE7B;">public</span>]]
<span style="color: #dcaeea;">entrypoint</span> = (tap-hold-next-release $tap-hold-delay @dwim (layer-toggle run))
[[<span style="color: #ECBE7B;">keys</span>]]
<span style="color: #dcaeea;">t</span> = toggle
</pre>
</div>
</div>
<div id="outline-container-org0299f77" class="outline-4">
<h4 id="org0299f77"><span class="section-number-4">1.20.1.</span> Runner Script</h4>
<div class="outline-text-4" id="text-1-20-1">
<p>
Using the <code>bash</code> shell so we can use arithmetic.
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #5B6268;">#</span><span style="color: #5B6268;">!/bin/</span><span style="color: #51afef;">bash</span>
</pre>
</div>

<p>
Let&rsquo;s first process our command-line argument to determine what to do.
If we want to <code>focus</code>, then let&rsquo;s attempt to activate a window containing the <code>st-runner</code> class, and if that fails, then proceed to the rest of the code, which will create a new runner instance!
If we want to <code>dwim</code> (do-what-I-mean), then IF the runner is <i>currently focused</i>, close the window, and <i>otherwise</i>, <code>focus</code> it.
This is usually what we want, since it doesn&rsquo;t make sense to try to re-focus the window if it&rsquo;s already focused!
</p>

<p>
On the other hand, if we want to <code>toggle</code>, then let&rsquo;s first attempt to <span class="underline">close</span> a window containing the <code>st-runner</code> class, and if <i>that</i> fails, then we proceed to the code for making a new instance!
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">processArg</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
    <span style="color: #51afef;">case</span> $<span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;"> in</span>
        focus)
            <span style="color: #5B6268;"># </span><span style="color: #5B6268;">when focusing, spawn new process if not open, and focus existing process if open</span>
            <span style="color: #51afef;">if</span> wmctrl -x -a st-runner; <span style="color: #51afef;">then</span>
                <span style="color: #5B6268;"># </span><span style="color: #5B6268;">successfully focused!</span>
                <span style="color: #51afef;">exit</span> <span style="color: #da8548; font-weight: bold;">0</span>
            <span style="color: #51afef;">fi</span>
            ;;
        toggle)
            <span style="color: #5B6268;"># </span><span style="color: #5B6268;">when toggling, spawn new process if not open, and KILL existing process if open</span>
            <span style="color: #51afef;">if</span> wmctrl -x -c st-runner; <span style="color: #51afef;">then</span>
                <span style="color: #5B6268;"># </span><span style="color: #5B6268;">successfully closed!</span>
                <span style="color: #51afef;">exit</span> <span style="color: #da8548; font-weight: bold;">0</span>
            <span style="color: #51afef;">fi</span>
            ;;
        dwim)
            <span style="color: #dcaeea;">focused_window</span>=$<span style="color: #c678dd;">(</span>xdotool getwindowfocus<span style="color: #c678dd;">)</span>
            <span style="color: #5B6268;"># </span><span style="color: #5B6268;">if focused window is the runner, exit code will be zero</span>
            <span style="color: #51afef;">if</span> xprop -notype -id <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">focused_window</span><span style="color: #98be65;">"</span> WM_CLASS | <span style="color: #ECBE7B;">grep</span> -q <span style="color: #98be65;">"st-runner"</span>; <span style="color: #51afef;">then</span>
                <span style="color: #5B6268;"># </span><span style="color: #5B6268;">close window</span>
                wmctrl -ic <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">focused_window</span><span style="color: #98be65;">"</span>
                <span style="color: #51afef;">exit</span> <span style="color: #da8548; font-weight: bold;">0</span>
            <span style="color: #51afef;">else</span>
                <span style="color: #5B6268;"># </span><span style="color: #5B6268;">https://stackoverflow.com/questions/4827690/how-to-change-a-command-line-argument-in-bash</span>
                processArg <span style="color: #98be65;">"focus"</span>
            <span style="color: #51afef;">fi</span>
            ;;
        *)
            <span style="color: #ECBE7B;">echo</span> <span style="color: #98be65;">"Invalid argument: please pass in focus|toggle|dwim"</span> &gt;&amp;<span style="color: #da8548; font-weight: bold;">2</span>
            <span style="color: #51afef;">exit</span> <span style="color: #da8548; font-weight: bold;">1</span>
    <span style="color: #51afef;">esac</span>
<span style="color: #51afef;">}</span>

processArg <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">1</span><span style="color: #98be65;">"</span>

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">If control reaches past this point without exiting, that means we have to </span><span style="color: #5B6268;">make</span>
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">a new instance of the runner.</span>
</pre>
</div>

<p>
Setting environment variables for the <code>fish</code> process to inherit.
</p>

<dl class="org-dl">
<dt><code>SKIP_FISH_GREETING</code></dt><dd>This is a custom variable that determines whether a message should display on startup.
I set it to 1 because I do not want it to output for the runner.</dd>
<dt><code>STARSHIP_CONFIG</code></dt><dd><a href="https://github.com/starship/starship/">Starship</a> is the shell prompt I am using.</dd>
</dl>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">SKIP_FISH_GREETING</span>=<span style="color: #da8548; font-weight: bold;">1</span>
<span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">STARSHIP_CONFIG</span>=|&gt;STARSHIP_RUNNER_CONFIG&lt;|
</pre>
</div>

<p>
Sets the working directory back to home
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ECBE7B;">cd</span>
</pre>
</div>

<p>
Now, let&rsquo;s determine the geometry for our terminal window.
First, we want the terminal to be placed on the active directory.
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #dcaeea;">FOCUSED_WINDOW</span>=$<span style="color: #51afef;">(</span>xdotool getwindowfocus<span style="color: #51afef;">)</span>
<span style="color: #c678dd;">eval</span> $<span style="color: #51afef;">(</span>xdotool getwindowgeometry --shell <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">FOCUSED_WINDOW</span><span style="color: #98be65;">"</span><span style="color: #51afef;">)</span>
<span style="color: #c678dd;">eval</span> $<span style="color: #51afef;">(</span>monitor-utils --shell --at-point $<span style="color: #dcaeea;">X</span> $<span style="color: #dcaeea;">Y</span> --geometry<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
This will give us the geometry of the monitor we have focused.
Now, we want to have 10% padding on the top, and have the terminal be centered in the middle of the screen.
From experimentation, 116 terminal columns translates to about 1660 pixels.
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #dcaeea;">TERMINAL_WIDTH</span>=<span style="color: #da8548; font-weight: bold;">1660</span>

<span style="color: #dcaeea;">y_padding</span>=$<span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>HEIGHT / <span style="color: #da8548; font-weight: bold;">10</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #dcaeea;">x_margin</span>=$<span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span>WIDTH - TERMINAL_WIDTH<span style="color: #98be65;">)</span> / <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #dcaeea;">terminal_x_offset</span>=$<span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>x_margin + X_OFFSET<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #dcaeea;">terminal_y_offset</span>=$<span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>y_padding + Y_OFFSET<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<dl class="org-dl">
<dt><code>|&gt;ST&lt;|</code></dt><dd><code>st</code> is the terminal emulator
<dl class="org-dl">
<dt><code>-c "..."</code></dt><dd>This sets the X11 classnames for the window.
My KDE config contains window rules that rounds the corners of windows with the <code>rounded</code> class and gives transparency and several other properties to the <code>st-runner</code> class</dd>
<dt><code>-g ...</code></dt><dd><p>
This sets the initial window dimensions for the terminal window.
</p>

<p>
The format we are using is <code>&lt;width&gt;x&lt;height&gt;+&lt;xoffset&gt;+&lt;yoffset&gt;</code>.
I believe everything is in terms of characters, so the width represents 100 characters, and the height represents 8 lines of space.
The offset, however, appears to be in pixels.
</p>

<p>
See <a href="https://manpages.debian.org/testing/libx11-doc/XParseGeometry.3.en.html">this link</a> for more details
</p></dd>
</dl></dd>
</dl>

<p>
Using <code>screen</code> to maintain a single shell session through each <code>runner</code> invocation.
</p>

<dl class="org-dl">
<dt><code>-DR runner</code></dt><dd>Attaches to a session called <code>runner</code>, creating it if necessary.
Some of <code>screen</code>&rsquo;s flag combinations seem a little arbitrary.</dd>
<dt><code>-s /bin/fish</code></dt><dd>Tells <code>screen</code> to start new sessions with the <code>fish</code> shell.</dd>
</dl>

<div class="org-src-container">
<pre class="src src-sh">|&gt;ST&lt;| -m <span style="color: #da8548; font-weight: bold;">15</span> -c <span style="color: #98be65;">"rounded st-runner"</span> -g <span style="color: #98be65;">"116x8+</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">{terminal_x_offset}</span><span style="color: #98be65;">+</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">{terminal_y_offset}</span><span style="color: #98be65;">"</span> screen -c ~/.config/kmonad/runner/screenrc -DR runner
</pre>
</div>

<p>
After <code>st</code> closes, we scroll down our runner so we no longer see the commands/output from earlier.
We do this by telling screen to send <code>Control+L</code> keystrokes to the <code>runner</code> session&rsquo;s first pane.
Since it&rsquo;s the same shell, we <i>will</i> still be in the same working directory and have the same history as before.
</p>
<div class="org-src-container">
<pre class="src src-sh">screen -S runner -X stuff <span style="color: #98be65;">"&#12;"</span>
</pre>
</div>

<dl class="org-dl">
<dt><code>term screen-256color</code></dt><dd>This line fixes the colors in the <code>screen</code> window.
Before, I was getting a lot of text that wasn&rsquo;t being highlighted.</dd>
</dl>
<div class="org-src-container">
<pre class="src src-text">term screen-256color
msgwait 0
shell /home/sridaran/.config/kmonad/runner/run_fish.sh
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #5B6268;">#</span><span style="color: #5B6268;">!/bin/</span><span style="color: #51afef;">dash</span>
<span style="color: #51afef;">exec</span> fish --init-command=<span style="color: #98be65;">"source </span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">HOME</span><span style="color: #98be65;">/.config/kmonad/runner/config.fish"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcd61491" class="outline-4">
<h4 id="orgcd61491"><span class="section-number-4">1.20.2.</span> Autoresizing on commands</h4>
<div class="outline-text-4" id="text-1-20-2">
<p>
I want my terminal to go full-height for certain commands, like <code>fzf</code>.
To do this, I will wrap the commands using functions which will emit a control code to the terminal emulator, telling it to resize.
</p>
<div class="org-src-container">
<pre class="src src-fish"><span style="color: #51afef;">function</span> <span style="color: #c678dd;">__fullsize_terminal</span> <span style="color: #51afef; font-weight: bold;">-d</span> <span style="color: #98be65;">"Emits a control code which causes the runner terminal to resize"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">tell terminal to resize;</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">source: https://unix.stackexchange.com/questions/575337/using-terminal-escape-sequences-within-gnu-screen</span>
    <span style="color: #c678dd;">echo</span> -e <span style="color: #98be65;">'\eP\005\e\\'</span> &gt; /dev/tty
<span style="color: #51afef;">end</span>

<span style="color: #51afef;">function</span> <span style="color: #c678dd;">__wrap_fullsize</span> <span style="color: #51afef; font-weight: bold;">-d</span> <span style="color: #98be65;">"Given a command, wraps it into a function with the same name, which will resize the terminal before running the command"</span>
    <span style="color: #51afef;">set</span> <span style="color: #dcaeea;">WRAPPED_COMMAND</span> <span style="color: #98be65;">$</span><span style="color: #dcaeea;">argv</span>[<span style="color: #da8548; font-weight: bold;">1</span>]
    <span style="color: #51afef;">function</span> <span style="color: #98be65;">$</span><span style="color: #dcaeea;">argv</span>[<span style="color: #da8548; font-weight: bold;">1</span>] -V WRAPPED_COMMAND -d <span style="color: #98be65;">"Runs $1 after resizing the terminal"</span>
        <span style="color: #5B6268;"># </span><span style="color: #5B6268;">get path of the wrapped command</span>
        <span style="color: #51afef;">set</span> <span style="color: #dcaeea;">command_path</span> (<span style="color: #c678dd;">which</span> <span style="color: #98be65;">$</span><span style="color: #dcaeea;">WRAPPED_COMMAND</span>)

        <span style="color: #c678dd;">__fullsize_terminal</span>

        <span style="color: #5B6268;"># </span><span style="color: #5B6268;">run command with the args</span>
        <span style="color: #98be65;">$</span><span style="color: #dcaeea;">command_path</span> <span style="color: #98be65;">$</span><span style="color: #dcaeea;">argv</span>
    <span style="color: #51afef;">end</span>
<span style="color: #51afef;">end</span>

<span style="color: #c678dd;">__wrap_fullsize</span> fzf
</pre>
</div>
</div>
</div>
<div id="outline-container-org251a54b" class="outline-4">
<h4 id="org251a54b"><span class="section-number-4">1.20.3.</span> <span class="todo TODO">TODO</span> Cleanup exit command</h4>
<div class="outline-text-4" id="text-1-20-3">
<p>
Right now, we are doing <code>killall st</code>, which only does what we want because we do not use <code>st</code> for anything else.
We should aim for a more robust solution.
</p>
</div>
</div>
<div id="outline-container-org6719161" class="outline-4">
<h4 id="org6719161"><span class="section-number-4">1.20.4.</span> <span class="done DONE">DONE</span> Reuse the <code>runner</code> terminal and shell between invocations</h4>
</div>
</div>
<div id="outline-container-org44bc6af" class="outline-3">
<h3 id="org44bc6af"><span class="section-number-3">1.21.</span> <span class="todo TODO">TODO</span> <a href="#coderef-prompt" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-prompt');" onmouseout="CodeHighlightOff(this, 'coderef-prompt');">Prompt</a></h3>
</div>
<div id="outline-container-orgc21d85a" class="outline-3">
<h3 id="orgc21d85a"><span class="section-number-3">1.22.</span> <a href="#coderef-agenda" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-agenda');" onmouseout="CodeHighlightOff(this, 'coderef-agenda');">Agenda</a></h3>
<div class="outline-text-3" id="text-1-22">
<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">aliases</span>]
<span style="color: #dcaeea;">agenda</span> = (cmd-button <span style="color: #98be65;">"$EMACSCLIENT -ce '(org-agenda nil \"o\")'"</span>)
</pre>
</div>
</div>
<div id="outline-container-org0f27848" class="outline-4">
<h4 id="org0f27848"><span class="section-number-4">1.22.1.</span> <span class="todo TODO">TODO</span> Open a floating, semi-transparent window</h4>
<div class="outline-text-4" id="text-1-22-1">
<p>
Instead of a fullscreen, opaque window.
</p>
</div>
</div>
<div id="outline-container-org6c1ec65" class="outline-4">
<h4 id="org6c1ec65"><span class="section-number-4">1.22.2.</span> <span class="done DONE">DONE</span> Maybe switch to org-agenda</h4>
<div class="outline-text-4" id="text-1-22-2">
</div>
</div>
</div>
<div id="outline-container-org48ee683" class="outline-3">
<h3 id="org48ee683"><span class="section-number-3">1.23.</span> <a href="#coderef-open-preset" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-open-preset');" onmouseout="CodeHighlightOff(this, 'coderef-open-preset');">Open Preset</a></h3>
<div class="outline-text-3" id="text-1-23">
<dl class="org-dl">
<dt><code>OPEN_PRESET_SCRIPT</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="orge7474ea">~/Development/Scripts/DE/presets/rofi_menu.sh
</pre>
</div></dd>
</dl>

<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">aliases</span>]
<span style="color: #dcaeea;">OPEN_PRESET_SCRIPT</span> = <span style="color: #98be65;">"~/Development/Scripts/DE/presets/rofi_menu.sh"</span>
<span style="color: #dcaeea;">open-preset</span> = (cmd-button <span style="color: #98be65;">"$OPEN_PRESET_SCRIPT"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org5b2e75f" class="outline-3">
<h3 id="org5b2e75f"><span class="section-number-3">1.24.</span> <a href="#coderef-org-capture" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-org-capture');" onmouseout="CodeHighlightOff(this, 'coderef-org-capture');">Org Capture</a></h3>
<div class="outline-text-3" id="text-1-24">
<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">aliases</span>]
<span style="color: #dcaeea;">org-capture</span> = (cmd-button <span style="color: #98be65;">"~/.local/bin/org-capture"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org711fd9f" class="outline-3">
<h3 id="org711fd9f"><span class="section-number-3">1.25.</span> <a href="#coderef-scroll" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-scroll');" onmouseout="CodeHighlightOff(this, 'coderef-scroll');">Scroll</a></h3>
<div class="outline-text-3" id="text-1-25">
<p>
We set the scroll buttons to invoke the <code>scroll.sh</code> script once on press and once on release.
On release, the script will kill the instance created on press
</p>

<dl class="org-dl">
<dt><code>SCROLL_SCRIPT</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="org9a15520">~/.config/kmonad/scroll/scroll.sh
</pre>
</div></dd>
<dt><code>SCROLL_SPEED_SCRIPT</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="org9af7027">~/.config/kmonad/scroll/scroll_speed.sh
</pre>
</div></dd>
</dl>

<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">scroll</span>]
[[<span style="color: #ECBE7B;">private</span>]]
<span style="color: #dcaeea;">scroll_script</span> = <span style="color: #98be65;">"|&gt;SCROLL_SCRIPT&lt;|"</span>
<span style="color: #dcaeea;">speed_script</span> = <span style="color: #98be65;">"|&gt;SCROLL_SPEED_SCRIPT&lt;|"</span>

<span style="color: #dcaeea;">left</span>  = (cmd-button <span style="color: #98be65;">"$scroll_script h -"</span>
                    <span style="color: #98be65;">"$scroll_script h 0"</span>)
<span style="color: #dcaeea;">up</span>    = (cmd-button <span style="color: #98be65;">"$scroll_script v -"</span>
                    <span style="color: #98be65;">"$scroll_script v 0"</span>)
<span style="color: #dcaeea;">down</span>  = (cmd-button <span style="color: #98be65;">"$scroll_script v +"</span>
                    <span style="color: #98be65;">"$scroll_script v 0"</span>)
<span style="color: #dcaeea;">right</span> = (cmd-button <span style="color: #98be65;">"$scroll_script h +"</span>
                    <span style="color: #98be65;">"$scroll_script h 0"</span>)

<span style="color: #dcaeea;">speed-up</span>   = (cmd-button <span style="color: #98be65;">"$speed_script 50"</span>
                         <span style="color: #98be65;">"$speed_script 0"</span>)
<span style="color: #dcaeea;">speed-down</span> = (cmd-button <span style="color: #98be65;">"$speed_script 200"</span>
                         <span style="color: #98be65;">"$speed_script 0"</span>)

<span style="color: #dcaeea;">exit_internal</span> = (layer-rem scroll)
[[<span style="color: #ECBE7B;">public</span>]]
<span style="color: #dcaeea;">enter</span> = (tap-hold-next-release $tap-hold-delay <span style="color: #5B6268;">#</span><span style="color: #5B6268;">((layer-add scroll) @kbd-set-backlight-on) (layer-toggle scroll))</span>
[[<span style="color: #ECBE7B;">keys</span>]]
<span style="color: #dcaeea;">h</span> = left
<span style="color: #dcaeea;">l</span> = right
<span style="color: #dcaeea;">k</span> = up
<span style="color: #dcaeea;">j</span> = down

<span style="color: #dcaeea;">caps</span> = speed-down
<span style="color: #dcaeea;">lctrl</span> = speed-down
<span style="color: #dcaeea;">lshift</span> = speed-up

<span style="color: #dcaeea;">lmet</span> = exit
</pre>
</div>
</div>
<div id="outline-container-org9cb2b49" class="outline-4">
<h4 id="org9cb2b49"><span class="section-number-4">1.25.1.</span> Scroll Script</h4>
<div class="outline-text-4" id="text-1-25-1">
<p>
These are the files storing the scroll variables.
</p>
<dl class="org-dl">
<dt><code>SCROLL_SPEED_FILE</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="org5d66a7f">/tmp/kmonad_scroll_script_speed
</pre>
</div></dd>
<dt><code>SCROLL_SPEED_FILE_OLD</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="org7298176">/tmp/kmonad_scroll_script_speed_old
</pre>
</div></dd>
<dt><code>SCROLL_HORIZONTAL</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="org9cce783">/tmp/kmonad_scroll_script_horizontal
</pre>
</div></dd>
<dt><code>SCROLL_VERTICAL</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="orgdf5e269">/tmp/kmonad_scroll_script_vertical
</pre>
</div></dd>
</dl>

<p>
Again using dash for speed
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #5B6268;">#</span><span style="color: #5B6268;">!/bin/</span><span style="color: #51afef;">dash</span>
</pre>
</div>

<dl class="org-dl">
<dt><code>DIRECTION</code></dt><dd>Either <code>h</code> for &ldquo;horizontal&rdquo; or <code>v</code> for &ldquo;vertical&rdquo;.</dd>
<dt><code>MAGNITUDE</code></dt><dd>Either <code>+</code> for the positive direction, <code>-</code> for the negative direction or <code>0</code> to stop</dd>
</dl>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #dcaeea;">DIRECTION</span>=<span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">1</span><span style="color: #98be65;">"</span>
<span style="color: #dcaeea;">MAGNITUDE</span>=<span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">2</span><span style="color: #98be65;">"</span>
</pre>
</div>

<p>
Check if a process is already running for the current direction, and kill it if necessary.
We have separate PID files for horizontal and vertical scrolling because we want to be able to scroll in both directions simultaneously.
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #51afef;">if</span> <span style="color: #51afef;">[</span> $<span style="color: #dcaeea;">DIRECTION</span> = <span style="color: #98be65;">"h"</span> <span style="color: #51afef;">]</span>
<span style="color: #51afef;">then</span>
    <span style="color: #dcaeea;">DIRECTION_PID_FILE</span>=|&gt;SCROLL_HORIZONTAL&lt;|

    <span style="color: #51afef;">if</span> <span style="color: #51afef;">[</span> $<span style="color: #dcaeea;">MAGNITUDE</span> = <span style="color: #98be65;">"-"</span> <span style="color: #51afef;">]</span>
    <span style="color: #51afef;">then</span>
        <span style="color: #5B6268;"># </span><span style="color: #5B6268;">if negative, then use scroll left button</span>
        <span style="color: #dcaeea;">TARGET_BUTTON</span>=<span style="color: #da8548; font-weight: bold;">6</span>
    <span style="color: #51afef;">else</span>
        <span style="color: #5B6268;"># </span><span style="color: #5B6268;">if positive, then use scroll right button</span>
        <span style="color: #dcaeea;">TARGET_BUTTON</span>=<span style="color: #da8548; font-weight: bold;">7</span>
    <span style="color: #51afef;">fi</span>
<span style="color: #51afef;">else</span>
    <span style="color: #dcaeea;">DIRECTION_PID_FILE</span>=|&gt;SCROLL_VERTICAL&lt;|

    <span style="color: #51afef;">if</span> <span style="color: #51afef;">[</span> $<span style="color: #dcaeea;">MAGNITUDE</span> = <span style="color: #98be65;">"-"</span> <span style="color: #51afef;">]</span>
    <span style="color: #51afef;">then</span>
        <span style="color: #5B6268;"># </span><span style="color: #5B6268;">if negative, then use scroll up button</span>
        <span style="color: #dcaeea;">TARGET_BUTTON</span>=<span style="color: #da8548; font-weight: bold;">4</span>
    <span style="color: #51afef;">else</span>
        <span style="color: #5B6268;"># </span><span style="color: #5B6268;">if positive, then use scroll down button</span>
        <span style="color: #dcaeea;">TARGET_BUTTON</span>=<span style="color: #da8548; font-weight: bold;">5</span>
    <span style="color: #51afef;">fi</span>
<span style="color: #51afef;">fi</span>

<span style="color: #51afef;">if</span> <span style="color: #51afef;">[</span> -e $<span style="color: #dcaeea;">DIRECTION_PID_FILE</span> <span style="color: #51afef;">]</span>
<span style="color: #51afef;">then</span>
    <span style="color: #ECBE7B;">kill</span> $<span style="color: #51afef;">(</span>head -n1 $<span style="color: #dcaeea;">DIRECTION_PID_FILE</span><span style="color: #51afef;">)</span>
    <span style="color: #ECBE7B;">rm</span> $<span style="color: #dcaeea;">DIRECTION_PID_FILE</span>
</pre>
</div>

<p>
This condition is an <code>else if</code> because if we are holding <code>h</code> and then press <code>l</code>, we want the two to <i>cancel out</i> rather than having the <code>l</code> override the <code>h</code>.
In this code, if the direction pid file exists, we kill the process, creating a new one <i>only</i> if we did not kill an existing one.
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #51afef;">elif</span> <span style="color: #51afef; font-weight: bold;">!</span> <span style="color: #51afef;">[</span> $<span style="color: #dcaeea;">MAGNITUDE</span> = <span style="color: #98be65;">"0"</span> <span style="color: #51afef;">]</span>
<span style="color: #51afef;">then</span>
</pre>
</div>

<p>
We want this section of code in a loop, so that if the speed changes we can react to it and restart <code>xdotool</code> with the new speed.
</p>
<div class="org-src-container">
<pre class="src src-sh">    <span style="color: #51afef;">while</span> true
    <span style="color: #51afef;">do</span>
</pre>
</div>

<p>
Get the current delay from <code>SCROLL_SPEED_FILE</code>, creating it if necessary
</p>
<div class="org-src-container">
<pre class="src src-sh">        <span style="color: #51afef;">if</span> <span style="color: #51afef; font-weight: bold;">!</span> <span style="color: #51afef;">[</span> -e |&gt;SCROLL_SPEED_FILE&lt;| <span style="color: #51afef;">]</span>
        <span style="color: #51afef;">then</span>
            <span style="color: #dcaeea;">DELAY</span>=<span style="color: #da8548; font-weight: bold;">150</span>
            <span style="color: #ECBE7B;">echo</span> $<span style="color: #dcaeea;">DELAY</span> &gt; |&gt;SCROLL_SPEED_FILE&lt;|
        <span style="color: #51afef;">else</span>
            <span style="color: #dcaeea;">DELAY</span>=$<span style="color: #51afef;">(</span><span style="color: #ECBE7B;">cat</span> |&gt;SCROLL_SPEED_FILE&lt;|<span style="color: #51afef;">)</span>
        <span style="color: #51afef;">fi</span>
</pre>
</div>

<p>
To emulate scrolling, we use <code>xdotool</code> to repeatedly send scroll button presses at a fixed interval: <code>$DELAY</code> milliseconds.
The <code>10000</code> number effectively represents &ldquo;infinity&rdquo;, as it means that the process will only exit after <code>10000 * $DELAY</code> milliseconds
</p>
<div class="org-src-container">
<pre class="src src-sh">        xdotool click --repeat <span style="color: #da8548; font-weight: bold;">10000</span> --delay $<span style="color: #dcaeea;">DELAY</span> $<span style="color: #dcaeea;">TARGET_BUTTON</span> &amp;
</pre>
</div>

<p>
<code>$$</code> is the PID of the shell process
</p>
<div class="org-src-container">
<pre class="src src-sh">        <span style="color: #ECBE7B;">echo</span> <span style="color: #98be65;">"$$"</span> &gt; <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">DIRECTION_PID_FILE</span><span style="color: #98be65;">"</span>
</pre>
</div>

<p>
Send incoming <code>SIGTERM</code>&rsquo;s to the <code>xdotool</code> process so that it can be killed (<a href="https://linuxconfig.org/how-to-propagate-a-signal-to-child-processes-from-a-bash-script">source</a>)
</p>
<div class="org-src-container">
<pre class="src src-sh">        <span style="color: #51afef;">trap</span> <span style="color: #98be65;">"</span><span style="color: #98be65;">kill</span><span style="color: #98be65;"> </span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">!</span><span style="color: #98be65;">"</span> TERM
</pre>
</div>

<p>
If we receive a <code>USR1</code> signal, restart the loop so the speed can be updated
</p>
<div class="org-src-container">
<pre class="src src-sh">        <span style="color: #51afef;">trap</span> <span style="color: #98be65;">"</span><span style="color: #98be65;">kill</span><span style="color: #98be65;"> </span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">!</span><span style="color: #98be65;">; wait </span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">!</span><span style="color: #98be65;">; continue"</span> USR1
</pre>
</div>

<p>
Wait for the <code>xdotool</code> process to complete
</p>
<div class="org-src-container">
<pre class="src src-sh">        <span style="color: #c678dd;">wait</span> $<span style="color: #dcaeea;">!</span>
</pre>
</div>

<p>
If we get to the end of the &ldquo;loop&rdquo; without <code>USR1</code> signal firing, we can safely exit
</p>
<div class="org-src-container">
<pre class="src src-sh">        <span style="color: #51afef;">break</span>
    <span style="color: #51afef;">done</span>
<span style="color: #51afef;">fi</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org4f1058e" class="outline-4">
<h4 id="org4f1058e"><span class="section-number-4">1.25.2.</span> Scroll Speed Script</h4>
<div class="outline-text-4" id="text-1-25-2">
<dl class="org-dl">
<dt><code>NEW_DELAY</code></dt><dd>The new delay in milliseconds that we need <code>xdotool</code> to use.
If it is equal to <code>0</code>, then reset the delay to the old delay</dd>
</dl>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #5B6268;">#</span><span style="color: #5B6268;">!/bin/</span><span style="color: #51afef;">dash</span>

<span style="color: #dcaeea;">NEW_DELAY</span>=$<span style="color: #da8548; font-weight: bold;">1</span>
</pre>
</div>

<p>
Save the current speed to another file
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #51afef;">if</span> <span style="color: #51afef;">[</span> $<span style="color: #dcaeea;">NEW_DELAY</span> -ne <span style="color: #da8548; font-weight: bold;">0</span> <span style="color: #51afef;">]</span>
<span style="color: #51afef;">then</span>
    <span style="color: #ECBE7B;">cat</span> |&gt;SCROLL_SPEED_FILE&lt;| &gt; |&gt;SCROLL_SPEED_FILE_OLD&lt;|

    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">write new speed to the file</span>
    <span style="color: #ECBE7B;">echo</span> $<span style="color: #dcaeea;">NEW_DELAY</span> &gt; |&gt;SCROLL_SPEED_FILE&lt;|
<span style="color: #51afef;">else</span>
    <span style="color: #ECBE7B;">cat</span> |&gt;SCROLL_SPEED_FILE_OLD&lt;| &gt; |&gt;SCROLL_SPEED_FILE&lt;|
<span style="color: #51afef;">fi</span>
</pre>
</div>

<p>
Send <code>USR1</code> signals to both the vertical and horizontal processes, so that they will refresh their speed
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ECBE7B;">kill</span> -s USR1 $<span style="color: #51afef;">(</span><span style="color: #ECBE7B;">cat</span> |&gt;SCROLL_VERTICAL&lt;|<span style="color: #51afef;">)</span>
<span style="color: #ECBE7B;">kill</span> -s USR1 $<span style="color: #51afef;">(</span><span style="color: #ECBE7B;">cat</span> |&gt;SCROLL_HORIZONTAL&lt;|<span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org082bb9d" class="outline-4">
<h4 id="org082bb9d"><span class="section-number-4">1.25.3.</span> Original Approach</h4>
<div class="outline-text-4" id="text-1-25-3">
<p>
This was my original idea, but I am now implementing scrolling through a shell script
</p>
<blockquote>
<p>
We are using keys F13-F16 to represent scrolling.
We need to do this because KMonad does not support sending mouse events.
Because these keys are not used for anything else (they aren&rsquo;t actually on the keyboard), we can safely remap them to buttons using <code>xmodmap</code>, which <i>does</i> support mouse buttons.
</p>
</blockquote>

<p>
This was in my <code>~/.Xmodmap</code>
</p>
<div class="org-src-container">
<pre class="src src-text">keycode 191 = Left
keycode 192 = Pointer_Button5
keycode 193 = Pointer_Button4
keycode 194 = Right
</pre>
</div>

<p>
First of all, <code>xmodmap</code> did not let me bind <code>191</code> and <code>194</code> to <code>Pointer_Button6</code> and <code>Pointer_Button7</code> (pushing the scroll wheel left/right), saying that it did not recognize either keysym.
As a workaround, I tried setting these to the arrow keys.
</p>

<p>
The horizontal arrow keys worked, but the up/down scrolling did not.
In most applications, the up/down arrow keys do selection in addition to scrolling, so binding <code>j</code> and <code>k</code> to arrow keys was not an acceptable solution
</p>

<p>
Scrolling works by repeatedly &ldquo;clicking&rdquo; the scroll buttons.
Whenever you scroll a scrollbar on your mouse, the speed at which you scroll determines how fast the scrolling occurs on your screen.
</p>

<p>
I believe the reason the vertical scrolling was not working is because KMonad was repeating the keypresses too quickly.
Because of this, it probably did not register as scrolling and was simply ignored.
</p>
</div>
</div>
</div>
<div id="outline-container-orgc18a5cc" class="outline-3">
<h3 id="orgc18a5cc"><span class="section-number-3">1.26.</span> <a href="#coderef-volume" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-volume');" onmouseout="CodeHighlightOff(this, 'coderef-volume');">Volume</a></h3>
<div class="outline-text-3" id="text-1-26">
<dl class="org-dl">
<dt><code>VOLUME_SCRIPT</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="org6f51f11">~/.config/kmonad/volume/volume.sh
</pre>
</div></dd>
<dt><code>VOLUME_TOGGLE_OSD_SCRIPT</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="org1139cac">~/.config/kmonad/volume/volume_popup_toggle.sh
</pre>
</div></dd>
<dt><code>VOLUME_SCRIPT_OSD_FILE</code></dt><dd><p>
Stores whether to show/hide volume <code>osd</code> popups
</p>
<div class="org-src-container">
<pre class="src src-text" id="org4ae7969">/tmp/kmonad_volume_script_display_osd
</pre>
</div></dd>
</dl>

<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">volume</span>]
[[<span style="color: #ECBE7B;">private</span>]]
<span style="color: #dcaeea;">volume_script</span> = <span style="color: #98be65;">"|&gt;VOLUME_SCRIPT&lt;|"</span>
<span style="color: #dcaeea;">toggle_osd_script</span> = <span style="color: #98be65;">"|&gt;VOLUME_TOGGLE_OSD_SCRIPT&lt;|"</span>

<span style="color: #dcaeea;">up</span>   = (cmd-button <span style="color: #98be65;">"$volume_script +"</span>
                   <span style="color: #98be65;">"$volume_script 0"</span>)
<span style="color: #dcaeea;">down</span> = (cmd-button <span style="color: #98be65;">"$volume_script -"</span>
                   <span style="color: #98be65;">"$volume_script 0"</span>)

<span style="color: #dcaeea;">toggle-osd</span> = (cmd-button <span style="color: #98be65;">"$toggle_osd_script"</span>)
<span style="color: #dcaeea;">mute</span> = (cmd-button <span style="color: #98be65;">"qdbus org.kde.kglobalaccel /component/kmix invokeShortcut mute"</span>)

<span style="color: #dcaeea;">play-pause</span> = <span style="color: #98be65;">'PlayPause'</span>

<span style="color: #dcaeea;">exit_internal</span> = (layer-rem volume)
[[<span style="color: #ECBE7B;">public</span>]]
<span style="color: #dcaeea;">enter</span> = (tap-hold-next-release $tap-hold-delay <span style="color: #5B6268;">#</span><span style="color: #5B6268;">((layer-add volume) @kbd-set-backlight-on) (layer-toggle volume))</span>
[[<span style="color: #ECBE7B;">keys</span>]]
<span style="color: #dcaeea;">k</span> = up
<span style="color: #dcaeea;">j</span> = down

<span style="color: #dcaeea;">m</span> = mute
<span style="color: #dcaeea;">q</span> = toggle-osd

<span style="color: #dcaeea;">p</span> = play-pause

<span style="color: #dcaeea;">lmet</span> = exit
</pre>
</div>
</div>
<div id="outline-container-org86c5e1b" class="outline-4">
<h4 id="org86c5e1b"><span class="section-number-4">1.26.1.</span> Volume Script</h4>
<div class="outline-text-4" id="text-1-26-1">
<dl class="org-dl">
<dt><code>VOLUME_SCRIPT_PID_FILE</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="org3ddf0f4">/tmp/kmonad_volume_script
</pre>
</div></dd>
<dt><code>VOLUME_HELPER_SCRIPT</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="org197c0f2">~/.config/kmonad/volume/change_volume.py
</pre>
</div></dd>
</dl>

<p>
Similar to the <a href="#org9cb2b49">1.25.1</a>, this script will modulate a parameter at a given rate, writing its own PID into a file so that it can be killed when a key is released
</p>

<dl class="org-dl">
<dt><code>VOLUME_CHANGE_DIRECTION</code></dt><dd>Either <code>+</code> to increase volume, <code>-</code>  to decrease it or <code>0</code> to stop.</dd>
</dl>

<p>
Like all of the other scripts, this one is POSIX-compliant
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #5B6268;">#</span><span style="color: #5B6268;">!/bin/</span><span style="color: #51afef;">dash</span>

<span style="color: #dcaeea;">VOLUME_CHANGE_DIRECTION</span>=<span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">1</span><span style="color: #98be65;">"</span>
</pre>
</div>

<p>
Kill the instance that is currently modifying the volume (if it exists).
<code>kill</code> will throw an error if the process is no longer alive, but that will not crash the script
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #dcaeea;">DIRECTION_PID_FILE</span>=|&gt;VOLUME_SCRIPT_PID_FILE&lt;|

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">Kill existing process if necessary</span>
<span style="color: #51afef;">if</span> <span style="color: #51afef;">[</span> -e $<span style="color: #dcaeea;">DIRECTION_PID_FILE</span> <span style="color: #51afef;">]</span>; <span style="color: #51afef;">then</span>
    <span style="color: #ECBE7B;">kill</span> <span style="color: #98be65;">"</span><span style="color: #51afef; font-weight: bold;">$(</span><span style="color: #51afef; font-weight: bold;">cat</span><span style="color: #51afef; font-weight: bold;"> </span><span style="color: #51afef; font-weight: bold;">$</span><span style="color: #51afef; font-weight: bold;">DIRECTION_PID_FILE</span><span style="color: #51afef; font-weight: bold;">)</span><span style="color: #98be65;">"</span>
    <span style="color: #ECBE7B;">rm</span> $<span style="color: #dcaeea;">DIRECTION_PID_FILE</span>
<span style="color: #51afef;">fi</span>
</pre>
</div>

<p>
Only run the code if the direction is non-zero
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #51afef;">if</span> <span style="color: #51afef; font-weight: bold;">!</span> <span style="color: #51afef;">[</span> <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">VOLUME_CHANGE_DIRECTION</span><span style="color: #98be65;">"</span> = <span style="color: #98be65;">"0"</span> <span style="color: #51afef;">]</span>; <span style="color: #51afef;">then</span>
</pre>
</div>

<p>
Reads whether or not to display <code>osd</code> popups from the disk
</p>
<div class="org-src-container">
<pre class="src src-sh">    <span style="color: #dcaeea;">DISPLAY_OSD_FILE</span>=|&gt;VOLUME_SCRIPT_OSD_FILE&lt;|

    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">I'm not exactly sure what a control is</span>
    <span style="color: #51afef;">if</span> <span style="color: #51afef;">[</span> -e $<span style="color: #dcaeea;">DISPLAY_OSD_FILE</span> <span style="color: #51afef;">]</span>; <span style="color: #51afef;">then</span>
        <span style="color: #dcaeea;">DISPLAY_OSD</span>=$<span style="color: #51afef;">(</span><span style="color: #ECBE7B;">cat</span> $<span style="color: #dcaeea;">DISPLAY_OSD_FILE</span><span style="color: #51afef;">)</span>
    <span style="color: #51afef;">else</span>
        <span style="color: #dcaeea;">DISPLAY_OSD</span>=<span style="color: #da8548; font-weight: bold;">1</span>
        <span style="color: #ECBE7B;">echo</span> $<span style="color: #dcaeea;">DISPLAY_OSD</span> &gt; $<span style="color: #dcaeea;">DISPLAY_OSD_FILE</span> &amp;
    <span style="color: #51afef;">fi</span>
</pre>
</div>

<p>
I had to go to the dark side and use text parsing to get the volume because when I revisited Arch Linux, I saw that the DBus interface for getting the audio control and manipulating the volume no longer existed.
</p>

<p>
I found the following command on <a href="https://unix.stackexchange.com/questions/89571/how-to-get-volume-level-from-the-command-line">StackOverflow</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Use amixer to get the current volume</span>
    <span style="color: #dcaeea;">CURRENT_VOLUME</span>=$<span style="color: #51afef;">(</span>amixer get Master | <span style="color: #ECBE7B;">grep</span> % | awk <span style="color: #98be65;">'{print $5}'</span> | sed -e <span style="color: #98be65;">'s/\[//'</span> -e <span style="color: #98be65;">'s/%\]//'</span> | head -n <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Explicitly unmute the output.
The <code>&amp;</code> spawns it in the background so that we don&rsquo;t add extra delay before the actual volume modulation
</p>
<div class="org-src-container">
<pre class="src src-sh">    pactl set-sink-mute @DEFAULT_SINK@ false &amp;
</pre>
</div>

<p>
Write the shell&rsquo;s pid to disk so the next invocation can kill it
</p>
<div class="org-src-container">
<pre class="src src-sh">    <span style="color: #ECBE7B;">echo</span> <span style="color: #98be65;">"$$"</span> &gt; <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">DIRECTION_PID_FILE</span><span style="color: #98be65;">"</span>
</pre>
</div>

<dl class="org-dl">
<dt><code>-E</code>​</dt><dd>Prevents unnecessary environment variables from being loaded (optimization).</dd>
<dt><code>-S</code></dt><dd>Prevents unnecessary modules from being loaded (optimization)</dd>
</dl>

<p>
The reasoning behind this section being written in Python can be found under <a href="#orgcc2acfc">1.26.1.1</a>​.
In this code, the <code>python2</code> process inherits the PID of the shell since we are using <code>exec</code>
</p>
<div class="org-src-container">
<pre class="src src-sh">    <span style="color: #51afef;">exec</span> python2 -ES |&gt;VOLUME_HELPER_SCRIPT&lt;| $<span style="color: #dcaeea;">CURRENT_VOLUME</span> $<span style="color: #dcaeea;">VOLUME_CHANGE_DIRECTION</span> $<span style="color: #dcaeea;">DISPLAY_OSD</span>
<span style="color: #51afef;">fi</span>
</pre>
</div>
</div>
<ol class="org-ol">
<li><a id="orgcc2acfc"></a>Volume Helper Script<br />
<div class="outline-text-5" id="text-1-26-1-1">
<p>
The reason I wrote this section in <del>Lua</del>​<code>python2</code> is because it requires a loop to run with a subsecond delay.
If this were written as part of the shell script, we would be calling out to <code>/bin/sleep</code> tens of times per second, and the interval could become visibly inconsistent.
</p>

<dl class="org-dl">
<dt><code>volume</code></dt><dd>An integer representing the starting volume percentage</dd>
<dt><code>increment</code></dt><dd><code>+</code> to increase volume, <code>-</code>  to decrease it or <code>0</code> to toggle mute.</dd>
<dt><code>display_osd</code></dt><dd><code>1</code> to display the <code>osd</code> popups when the volume changes, <code>0</code> to suppress them</dd>
</dl>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #51afef;">from</span> time <span style="color: #51afef;">import</span> sleep
<span style="color: #51afef;">from</span> os <span style="color: #51afef;">import</span> system
<span style="color: #51afef;">from</span> sys <span style="color: #51afef;">import</span> argv

<span style="color: #dcaeea;">volume</span> = <span style="color: #c678dd;">int</span>(argv[<span style="color: #da8548; font-weight: bold;">1</span>])
<span style="color: #dcaeea;">increment</span> = <span style="color: #da8548; font-weight: bold;">1</span> <span style="color: #51afef;">if</span> argv[<span style="color: #da8548; font-weight: bold;">2</span>] == <span style="color: #98be65;">'+'</span> <span style="color: #51afef;">else</span> -<span style="color: #da8548; font-weight: bold;">1</span>
<span style="color: #dcaeea;">display_osd</span> = <span style="color: #a9a1e1;">True</span> <span style="color: #51afef;">if</span> argv[<span style="color: #da8548; font-weight: bold;">3</span>] == <span style="color: #98be65;">'1'</span> <span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">False</span>
</pre>
</div>

<p>
When we receive a <code>USR1</code> signal from the <a href="#org5db828a">1.26.2</a>, invert the value of <code>display_osd</code>.
This is equivalent to reading the new value of the file; we know that the script would have inverted the value from what it was originally, so we can simply invert our variable to mirror it.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #51afef;">import</span> signal

<span style="color: #51afef;">def</span> <span style="color: #c678dd;">usr1_handler</span>(signum, frame):
    <span style="color: #51afef;">global</span> display_osd
    <span style="color: #dcaeea;">display_osd</span> = <span style="color: #51afef;">not</span> display_osd

signal.signal(signal.SIGUSR1, usr1_handler)
</pre>
</div>

<p>
f-strings were only introduced in python3.6, so this code uses <code>string.format</code>.
I was originally confused by <code>string.format</code>, thinking <code>string</code> was a module, but in reality <code>format</code> is a method defined on the <code>string</code> class.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #51afef;">while</span> <span style="color: #a9a1e1;">True</span>:
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Clamp the range of the loop between 0 and 100</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Without these checks, there would be nothing stopping it from going out of bounds</span>
    <span style="color: #51afef;">if</span> volume &gt; <span style="color: #da8548; font-weight: bold;">100</span> <span style="color: #51afef;">and</span> increment &gt; <span style="color: #da8548; font-weight: bold;">0</span> <span style="color: #51afef;">or</span> volume &lt; <span style="color: #da8548; font-weight: bold;">0</span> <span style="color: #51afef;">and</span> increment &lt; <span style="color: #da8548; font-weight: bold;">0</span>:
        <span style="color: #51afef;">break</span>

    <span style="color: #dcaeea;">volume</span> += increment

    system(<span style="color: #98be65;">'pactl set-sink-volume @DEFAULT_SINK@ {}%'</span>.<span style="color: #c678dd;">format</span>(volume))

    <span style="color: #51afef;">if</span> display_osd:
        system(<span style="color: #98be65;">'qdbus org.kde.plasmashell /org/kde/osdService org.kde.osdService.volumeChanged {}'</span>.<span style="color: #c678dd;">format</span>(volume))

    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">30 ms delay</span>
    sleep(<span style="color: #da8548; font-weight: bold;">0.030</span>)
</pre>
</div>
<p>
This code could be further optimized by spawning the system commands with <code>subprocess.Popen</code>, saving the handles to a list and polling/filtering them on each iteration of the loop.
The <a href="https://pypi.org/project/subprocess32/">subprocess32</a> package is recommended when using <code>subprocess</code> in <code>python2</code>, since the stock version of <code>subprocess</code> that ships with it has several issues.
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org5db828a" class="outline-4">
<h4 id="org5db828a"><span class="section-number-4">1.26.2.</span> Volume OSD Toggle Script</h4>
<div class="outline-text-4" id="text-1-26-2">
<p>
This script switches the contents of <code>$DISPLAY_OSD_FILE</code> between 0 and 1, setting the value to 0 if the file does not exist.
</p>

<dl class="org-dl">
<dt><code>sed</code></dt><dd>Stream editor
<dl class="org-dl">
<dt><code>-i "$DISPLAY_OSD_FILE"</code></dt><dd>Modifies the file in-place, so we don&rsquo;t need to open the file once for reading and again for writing.</dd>
<dt><code>'y/01/10'</code></dt><dd><p>
From the <code>sed</code> man page for the <code>y</code> command:
</p>
<blockquote>
<p>
Transliterate the characters in the pattern space which appear in source to the corresponding character in dest.
</p>
</blockquote>
<p>
This effectively maps <code>0</code> to <code>1</code> and <code>1</code> to <code>0</code>.
</p></dd>
</dl></dd>
</dl>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #5B6268;">#</span><span style="color: #5B6268;">!/bin/</span><span style="color: #51afef;">dash</span>

<span style="color: #dcaeea;">DISPLAY_OSD_FILE</span>=|&gt;VOLUME_SCRIPT_OSD_FILE&lt;|

<span style="color: #51afef;">if</span> <span style="color: #51afef; font-weight: bold;">!</span> <span style="color: #51afef;">[</span> -e $<span style="color: #dcaeea;">DISPLAY_OSD_FILE</span> <span style="color: #51afef;">]</span>; <span style="color: #51afef;">then</span>
    <span style="color: #ECBE7B;">echo</span> <span style="color: #98be65;">"0"</span> &gt; <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">DISPLAY_OSD_FILE</span><span style="color: #98be65;">"</span>
<span style="color: #51afef;">else</span>
    sed -i <span style="color: #98be65;">'y/01/10/'</span> <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">DISPLAY_OSD_FILE</span><span style="color: #98be65;">"</span>
<span style="color: #51afef;">fi</span>

<span style="color: #51afef;">if</span> <span style="color: #51afef;">[</span> -e |&gt;VOLUME_SCRIPT_PID_FILE&lt;| <span style="color: #51afef;">]</span>; <span style="color: #51afef;">then</span>
    <span style="color: #ECBE7B;">kill</span> -s USR1 $<span style="color: #51afef;">(</span><span style="color: #ECBE7B;">cat</span> |&gt;VOLUME_SCRIPT_PID_FILE&lt;|<span style="color: #51afef;">)</span>
<span style="color: #51afef;">fi</span>
</pre>
</div>

<p>
This is an alternate implementation of the swap using <code>tr</code>.
See <a href="https://stackoverflow.com/questions/6696842/how-can-i-use-a-file-in-a-command-and-redirect-output-to-the-same-file-without-t">this</a> StackOverflow post on why we can&rsquo;t redirect the output of <code>tr</code> back into the file using <code>&gt;</code>.
</p>
<pre class="example" id="org6e0bf22">
tr '01' '10' &lt; $DISPLAY_OSD_FILE | sponge $DISPLAY_OSD_FILE
</pre>
</div>
</div>
<div id="outline-container-orgb5250d6" class="outline-4">
<h4 id="orgb5250d6"><span class="section-number-4">1.26.3.</span> <span class="done DONE">DONE</span> Volume layer</h4>
<div class="outline-text-4" id="text-1-26-3">
<p>
The volume layer would remap hjkl to control the volume.
</p>
</div>
</div>
<div id="outline-container-org5e98de6" class="outline-4">
<h4 id="org5e98de6"><span class="section-number-4">1.26.4.</span> <span class="todo TODO">TODO</span> Volume Next/Prev</h4>
<div class="outline-text-4" id="text-1-26-4">
<p>
Rotate to next/previous output with h/l
</p>
</div>
</div>
</div>
<div id="outline-container-orgb3e1602" class="outline-3">
<h3 id="orgb3e1602"><span class="section-number-3">1.27.</span> <a href="#coderef-yank" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-yank');" onmouseout="CodeHighlightOff(this, 'coderef-yank');">Yank</a></h3>
<div class="outline-text-3" id="text-1-27">
<dl class="org-dl">
<dt>Yank Script</dt><dd><div class="org-src-container">
<pre class="src src-text" id="org43f3460">~/.config/kmonad/yank/yank_active_window.sh
</pre>
</div></dd>
</dl>

<p>
Copies the actively focused window title to the clipboard.
</p>
<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">aliases</span>]
<span style="color: #dcaeea;">yank_script</span> = <span style="color: #98be65;">"|&gt;YANK_SCRIPT&lt;|"</span>
<span style="color: #dcaeea;">yank</span> = (cmd-button <span style="color: #98be65;">"$yank_script"</span>)
</pre>
</div>
</div>
<div id="outline-container-orgb5868a3" class="outline-4">
<h4 id="orgb5868a3"><span class="section-number-4">1.27.1.</span> Yank Script</h4>
<div class="outline-text-4" id="text-1-27-1">
<p>
This script copies the title to the clipboard, and also emits a notification to the screen.
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #5B6268;">#</span><span style="color: #5B6268;">!/bin/</span><span style="color: #51afef;">dash</span>
<span style="color: #dcaeea;">window_title</span>=$<span style="color: #51afef;">(</span>xdotool getactivewindow getwindowname<span style="color: #51afef;">)</span>

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">copy to clipboard</span>
<span style="color: #ECBE7B;">echo</span> <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">window_title</span><span style="color: #98be65;">"</span> | xclip -selection c -r
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">send notification</span>
qdbus org.kde.plasmashell /org/kde/osdService org.kde.osdService.showText <span style="color: #98be65;">"document-duplicate"</span> <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">window_title</span><span style="color: #98be65;">"</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orge87fff6" class="outline-3">
<h3 id="orge87fff6"><span class="section-number-3">1.28.</span> <a href="#coderef-switch-focus" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-switch-focus');" onmouseout="CodeHighlightOff(this, 'coderef-switch-focus');">Switch Focus</a></h3>
<div class="outline-text-3" id="text-1-28">
<dl class="org-dl">
<dt><code>SWITCH_MOUSE_SCREEN_SCRIPT</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="orgd686928">/home/sridaran/Development/Scripts/DE/mouseToNextDesktop.sh
</pre>
</div></dd>
</dl>

<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">aliases</span>]
<span style="color: #dcaeea;">SWITCH_MOUSE_SCREEN_SCRIPT</span> = <span style="color: #98be65;">"|&gt;SWITCH_MOUSE_SCREEN_SCRIPT&lt;|"</span>

<span style="color: #dcaeea;">switch_mouse_screen</span> = (cmd-button <span style="color: #98be65;">"$SWITCH_MOUSE_SCREEN_SCRIPT"</span>)
<span style="color: #dcaeea;">switch_focus_screen</span> = (cmd-button <span style="color: #98be65;">"qdbus org.kde.kglobalaccel /component/kwin invokeShortcut \"Switch to Next Screen\""</span>)

<span style="color: #dcaeea;">switch_focus_composite</span> = (tap-hold $tap-hold-delay-min @switch_focus_screen @switch_mouse_screen)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd639a52" class="outline-3">
<h3 id="orgd639a52"><span class="section-number-3">1.29.</span> <a href="#coderef-vim" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-vim');" onmouseout="CodeHighlightOff(this, 'coderef-vim');">Vim</a></h3>
<div class="outline-text-3" id="text-1-29">
<dl class="org-dl">
<dt><code>NVIM</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="org456314c">/home/sridaran/Packages/neovim/nvim0-6-0.appimage
</pre>
</div></dd>
<dt><code>NVIM_SCRIPT</code></dt><dd><div class="org-src-container">
<pre class="src src-text" id="orge666c65">/home/sridaran/.config/kmonad/vim/run_neovim.sh
</pre>
</div></dd>
</dl>

<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">aliases</span>]
<span style="color: #dcaeea;">NVIM_SCRIPT</span> = <span style="color: #98be65;">"|&gt;NVIM_SCRIPT&lt;|"</span>
<span style="color: #dcaeea;">vim</span> = (cmd-button <span style="color: #98be65;">"kitty fish -C \"$NVIM_SCRIPT\""</span>)
</pre>
</div>
</div>
<div id="outline-container-orgdca269f" class="outline-4">
<h4 id="orgdca269f"><span class="section-number-4">1.29.1.</span> Run Neovim Script</h4>
<div class="outline-text-4" id="text-1-29-1">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #5B6268;">#</span><span style="color: #5B6268;">!/bin/</span><span style="color: #51afef;">dash</span>

<span style="color: #dcaeea;">ELAPSED_TIME</span>=$<span style="color: #51afef;">(</span>/bin/time -f <span style="color: #98be65;">'%E'</span> |&gt;NEOVIM&lt;|<span style="color: #51afef;">)</span>
zenity --text <span style="color: #98be65;">"Ran for </span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">ELAPSED_TIME</span><span style="color: #98be65;">"</span> --notification
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org743cedb" class="outline-3">
<h3 id="org743cedb"><span class="section-number-3">1.30.</span> <a href="#coderef-simple-datetime-overlay" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-simple-datetime-overlay');" onmouseout="CodeHighlightOff(this, 'coderef-simple-datetime-overlay');">Simple Datetime Overlay</a></h3>
<div class="outline-text-3" id="text-1-30">
<dl class="org-dl">
<dt>Simple Datetime Overlay Path</dt><dd><div class="org-src-container">
<pre class="src src-text" id="org0c5c8c7">/home/sridaran/.local/bin/simple-datetime-overlay
</pre>
</div></dd>
</dl>

<p>
This is a simple button that spawns my program and then kills all instances of it.
</p>
<div class="org-src-container">
<pre class="src src-kbdx">[<span style="color: #ECBE7B;">aliases</span>]
<span style="color: #dcaeea;">SIMPLE_DATETIME_OVERLAY</span> = <span style="color: #98be65;">"|&gt;SDO_SCRIPT_PATH&lt;|"</span>
<span style="color: #dcaeea;">simple-datetime-overlay</span> = (cmd-button <span style="color: #98be65;">"/bin/dash -c '$SIMPLE_DATETIME_OVERLAY'"</span> <span style="color: #98be65;">"sleep 0.15; kill \$(pgrep -f simple-datetime-overlay)"</span>)
</pre>
</div>

<p>
Here are my issues with <code>simple-datetime-overlay</code>:
</p>
<ol class="org-ol">
<li>Setting it to show up on all monitors is ideal, but it feels too slow unless I have my CPU profile on high or max</li>
<li><b>Setting it to show up on the active monitor is nice, but sometimes I don&rsquo;t know which monitor is active so I don&rsquo;t know where to look</b></li>
<li>Setting it to show up on monitor 0 makes it consistently fast, but I don&rsquo;t want to have to turn my head to look at it</li>
</ol>

<p>
Ideally, show up on all monitors when we are on max performance, active monitor otherwise.
</p>
</div>
<div id="outline-container-org48088ac" class="outline-4">
<h4 id="org48088ac"><span class="section-number-4">1.30.1.</span> Invoke Simple Datetime Overlay Script</h4>
<div class="outline-text-4" id="text-1-30-1">
<dl class="org-dl">
<dt>SDO Script Path </dt><dd><div class="org-src-container">
<pre class="src src-text" id="orgab98894">/home/sridaran/.config/kmonad/simple-datetime-overlay/simple-datetime-overlay.sh
</pre>
</div></dd>

<dt>CPUFreq Active Profile Path</dt><dd><div class="org-src-container">
<pre class="src src-text" id="org73aa7e6">/home/sridaran/.cache/set-cpufreq-profile/active-profile
</pre>
</div></dd>
</dl>

<p>
This script checks what my current cpu profile is, and if it is on max performance, then it displays the datetime overlay on all monitors.
Otherwise, it displays it only on the active monitor.
</p>

<p>
On medium performance mode and below, use the <code>tock</code> command-line program to render a clock in the <code>st</code> terminal.
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #5B6268;">#</span><span style="color: #5B6268;">!/bin/</span><span style="color: #51afef;">dash</span>

<span style="color: #dcaeea;">CURRENT_CPUFREQ_PROFILE</span>=$<span style="color: #51afef;">(</span><span style="color: #ECBE7B;">cat</span> <span style="color: #98be65;">"|&gt;CPUFREQ_ACTIVE_PROFILE&lt;|"</span><span style="color: #51afef;">)</span>

<span style="color: #dcaeea;">PROGRAM</span>=|&gt;SIMPLE_DATETIME_OVERLAY&lt;|
<span style="color: #dcaeea;">PARAMS</span>=<span style="color: #98be65;">"--only-monitor 0"</span>

<span style="color: #51afef;">case</span> <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">CURRENT_CPUFREQ_PROFILE</span><span style="color: #98be65;">"</span><span style="color: #51afef;"> in</span>
    <span style="color: #98be65;">"Max Performance"</span>)
        <span style="color: #dcaeea;">PARAMS</span>=<span style="color: #98be65;">""</span>
        ;;
    <span style="color: #98be65;">"High Performance"</span>)
        <span style="color: #dcaeea;">PARAMS</span>=<span style="color: #98be65;">"-a"</span>
        ;;
    *)
        <span style="color: #dcaeea;">PROGRAM</span>=st

        <span style="color: #dcaeea;">PARAMS</span>=<span style="color: #98be65;">"-c simple-datetime-overlay-tock -g 95x15 -t 'simple-datetime-overlay' -- /home/sridaran/.cargo/bin/tock --seconds --center --format '%A, %B %d, %Y'"</span>
        ;;
<span style="color: #51afef;">esac</span>

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">source: https://superuser.com/questions/1529226/get-bash-to-respect-quotes-when-word-splitting-subshell-output</span>
<span style="color: #ECBE7B;">echo</span> $<span style="color: #dcaeea;">PARAMS</span> | xargs $<span style="color: #dcaeea;">PROGRAM</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org54bd7d7" class="outline-3">
<h3 id="org54bd7d7"><span class="section-number-3">1.31.</span> Buffer Procedures</h3>
<div class="outline-text-3" id="text-1-31">
</div>
<div id="outline-container-orgfd91741" class="outline-4">
<h4 id="orgfd91741"><span class="section-number-4">1.31.1.</span> Tangle and Compile</h4>
<div class="outline-text-4" id="text-1-31-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">progn</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">org-babel-tangle</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let*</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>error-bufname <span style="color: #98be65;">"KMonadX Compilation Output"</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #a9a1e1;">(</span><span style="color: #dcaeea;">display-buffer-alist</span> <span style="color: #51afef;">'</span><span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">".*"</span> display-buffer-at-bottom<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">progn</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">get-buffer-create</span> error-bufname<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">with-current-buffer</span> error-bufname
        <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">erase-buffer</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>

      <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">call-process</span> <span style="color: #98be65;">"fish"</span> nil <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">get-buffer</span> error-bufname<span style="color: #51afef;">)</span> nil <span style="color: #98be65;">"-c ./compile.sh"</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">not</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">eq</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">buffer-size</span> <span style="color: #a9a1e1;">(</span><span style="color: #a9a1e1;">get-buffer</span> error-bufname<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span> <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
          <span style="color: #51afef;">(</span><span style="color: #51afef;">progn</span>
            <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">display-buffer</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">get-buffer</span> error-bufname<span style="color: #98be65;">)</span> nil<span style="color: #c678dd;">)</span>
            <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">switch-to-buffer-other-window</span> error-bufname<span style="color: #c678dd;">)</span>
            <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">ansi-color-apply-on-region</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point-min</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">point-max</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
        <span style="color: #51afef;">(</span><span style="color: #51afef;">progn</span>
          <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #98be65;">"%s"</span> <span style="color: #98be65;">"Compilation completed successfully!"</span><span style="color: #c678dd;">)</span>
          <span style="color: #c678dd;">(</span><span style="color: #51afef;">when</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">y-or-n-p</span> <span style="color: #98be65;">"Restart KMonad?"</span><span style="color: #98be65;">)</span>
            <span style="color: #98be65;">(</span><span style="color: #c678dd;">srithon/spawn-process</span> <span style="color: #98be65;">"systemctl"</span> <span style="color: #98be65;">"--user"</span> <span style="color: #98be65;">"restart"</span> <span style="color: #98be65;">"kmonad"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org6e975c4" class="outline-3">
<h3 id="org6e975c4"><span class="section-number-3">1.32.</span> <span class="todo TODO">TODO</span> <a href="#coderef-local-leader" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-local-leader');" onmouseout="CodeHighlightOff(this, 'coderef-local-leader');">Local Leader</a></h3>
<div class="outline-text-3" id="text-1-32">
</div>
</div>
</div>
<div id="outline-container-org65b5f34" class="outline-2">
<h2 id="org65b5f34"><span class="section-number-2">2.</span> KMonad Documentation</h2>
<div class="outline-text-2" id="text-2">
<p>
Documentation was copied from <a href="https://github.com/kmonad/kmonad/blob/master/keymap/tutorial.kbd">tutorial.kbd</a> and adapted for Org mode
</p>
</div>
<div id="outline-container-orge2c0203" class="outline-3">
<h3 id="orge2c0203"><span class="section-number-3">2.1.</span> Basic Syntax</h3>
<div class="outline-text-3" id="text-2-1">
<p>
KMonad&rsquo;s configuration language is styled on various lisps, like scheme or
Common Lisp. In a lisp, every statement is entered between &rsquo;(&rsquo; and &rsquo;)&rsquo;s. If
you are more used to Fortan style languages (python, ruby, C, Java, etc.), the
change is quite straightforward: the function name moves into the parentheses,
and you don&rsquo;t use commas to separate arguments. I.e.
</p>

<p>
This:     my_function(a, 3, &ldquo;Alakazam&rdquo;)
Becomes:  (my_function a 3 &ldquo;Alakazam&rdquo;)
</p>

<p>
The reason for this is because Lisp-style languages are very easy to parse and
write syntax-highlighters for.
</p>

<p>
We also provide standard Lisp syntax for comments:
</p>
<ul class="org-ul">
<li>block comments between: #| and its reverse</li>
<li><p>
line comments following: ;;
</p>

<p>
Unlike standard lisp, a single ; does not denote a command, but instead the
keycode for semicolon.
</p>

<p>
Also, as you might have noticed, whitespace is possible anywhere.
</p>

<p>
To check for syntax errors while editing, invoke kmonad with the -d option.
</p></li>
</ul>
</div>
</div>
<div id="outline-container-orgc184e70" class="outline-3">
<h3 id="orgc184e70"><span class="section-number-3">2.2.</span> defcfg block</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Necessary: the `defcfg` block
</p>

<p>
There are a few bits of information that are required to be present in a
KMonad configuration file. One of these is the existence of exactly 1 `defcfg`
statement. This statement is used to customize various configuration settings.
Many of these settings have default values, but a minimal definition must
include at least an &rsquo;input&rsquo; field and an &rsquo;output&rsquo; field. These describe how
KMonad captures its inputs and how it emits its outputs.
</p>

<p>
First, let&rsquo;s go over the optional, non-OS specific settings. Currently there is
only 2:
</p>

<ul class="org-ul">
<li><p>
fallthrough: `true` or `false`, defaults to `false`
</p>

<p>
KMonad catches input events and tries to match them to various handlers. If
it cannot match an event to any handler (for example, if it isn&rsquo;t included
in the `defsrc` block, or if it is, but the current keymap does not map any
buttons to it), then the event gets quietly ignored. If `fallthrough` is set
to `true`, any unhandled events simply get reemitted.
</p></li>

<li><p>
allow-cmd: `true` or `false`, defaults to `false`
</p>

<p>
If this is set to `false`, any action that runs a shell-command will simply
log to `stdout` without ever running (log-level info). Don&rsquo;t ever enable
this on a configuration that you do not trust, because:
</p>

<p>
(cmd-button &ldquo;rm -rf ~/*&rdquo;)
</p>

<p>
is a thing. For more information on the `cmd-button&rsquo; function, see the
section on Command buttons below.
</p>

<p>
There are also some optional OS specific settings that we support:
</p>

<ul class="org-ul">
<li><p>
`cmp-seq&rsquo;: KEY, defaults to `RightAlt&rsquo; (Linux X11 specific)
</p>

<p>
This sets your compose key for Unicode input. For more information, as well
as a workaround to also make this work on windows, see the section on
Compose-key sequences below.
</p></li>

<li><p>
`cmp-seq-delay&rsquo;: NUMBER (in milliseconds)
</p>

<p>
This sets a delay between each pressed key in a compose-key sequence.  Some
environments may have troubles recognizing the key sequence if it&rsquo;s pressed
too rapidly; if you experience any problems in this direction, you can try
setting this value to `5&rsquo; or `10&rsquo; and see if that helps.
</p></li>
</ul>

<p>
Secondly, let&rsquo;s go over how to specify the `input` and `output` fields of a
`defcfg` block. This differs between OS&rsquo;es, and so do the capabilities of
these interfaces.
</p></li>
</ul>
</div>
<ol class="org-ol">
<li><a id="org2c2c001"></a>Linux<br />
<div class="outline-text-5" id="text-2-2-0-1">
<p>
In Linux we deal with input by performing an ioctl-grab on a specific
device-file. This allows us to hook KMonad on the input of exactly 1 keyboard,
and allows you to run multiple instances of KMonad for different keyboards. We
make an input using:
(device-file &ldquo;/dev/input/by-id/my-keyboard-kbd&rdquo;)
</p>

<p>
NOTE: Any valid path to a device-file will work, but it is recommended to use
the &rsquo;by-id&rsquo; directory, since these names will not change if you replug the
device.
</p>

<p>
We deal with output by creating a &rsquo;uinput&rsquo; device. This requires that the
&rsquo;uinput&rsquo; kernel module is loaded. The easiest way to ensure this is by calling
&rsquo;sudo modprobe uinput&rsquo;. We create a uinput device using:
(uinput-sink &ldquo;name&rdquo; &ldquo;optional post-init command&rdquo;)
</p>
</div>
</li>
<li><a id="org00a984e"></a>Windows<br />
<div class="outline-text-5" id="text-2-2-0-2">
<p>
In Windows we do not get such fine-grained control. We use a low-level
keyboard hook to intercept all non-injected keyboard events. There is
currently an open issue to improve the C-bindings used to capture windows
keyevents, and if you have a better way to approach this issue, help is deeply
appreciated. You specify a windows input using:
(low-level-hook)
</p>

<p>
Similarly, the output in Windows lacks the fine-grained control. We use the
SendEvent API to emit key events directly to Windows. Since these are
&rsquo;artificial&rsquo; events we won&rsquo;t end up catching them again by the
`low-level-hook`. It is very likely that KMonad does not play well with other
programs that capture keyboard input like AHK. You specify windows output using:
(send-event-sink)
</p>
</div>
</li>
<li><a id="orgaf47e68"></a>MacOS<br />
<div class="outline-text-5" id="text-2-2-0-3">
<p>
For Mac questions I suggest filing an issue and tagging @thoelze1, he wrote
the MacOS API. However, input using:
(iokit-name &ldquo;optional product string&rdquo;)
</p>

<p>
By default this should grab all keyboards, however if a product string is
provided, KMonad will only capture those devices that match the provided
product string. If you would like to provide a product string, you can run
`make; ./list-keyboards&rsquo; in c_src/mac to list the product strings of all
connected keyboards.
</p>

<p>
You initialize output on MacOS using:
(kext)
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org91ef98e" class="outline-3">
<h3 id="org91ef98e"><span class="section-number-3">2.3.</span> defsrc block</h3>
<div class="outline-text-3" id="text-2-3">
<p>
Necessary: the `defsrc` block
</p>

<p>
It is difficult to explain the `defsrc` block without immediately going into
`deflayer` blocks as well. Essentially, KMonad maps input-events to various
internal actions, many of which generate output events. The `defsrc` block
explains the layout on which we specify our `deflayer`s down the line.
</p>

<p>
It is important to realize that the `defsrc` block doesn&rsquo;t <b>necessarily</b> have
to coincide with your actual input keyboard. You can specify a full 100%
`defsrc` block, but only use a 40% keyboard. This will mean that every
`deflayer` you specify will also have to match your 100% `defsrc`, and that
your actual keyboard would be physically unable to trigger about 60% of your
keymap, but it would be perfectly valid syntax.
</p>

<p>
The dual of this (and more useful) is that it is also perfectly valid to only
specify that part of your keyboard in `defsrc` that you want to remap. If you
use a 100% keyboard, but don&rsquo;t want to remap the numpad at all you can simply
leave the numpad out of your `defsrc`, and it should work just fine. In that
particular case you probably want to set `fallthrough` to `true` in your
`defcfg` block though.
</p>

<p>
In the future we would like to provide support for multiple, named `defsrc`
blocks, so that it becomes easier to specify various layers for just the
numpad, for example, but at the moment any more or less than 1 `defsrc` block
will result in an error.
</p>

<p>
The layouting in the `defsrc` block is completely free, whitespace simply gets
ignored. We strive to provide a name for every keycode that is no longer than
4 characters, so we find that laying out your keymap in columns of 5 works out
quite nicely (although wider columns will allow for more informative aliases,
see below).
</p>

<p>
Most keycodes should be obvious. If you are unsure, check
&rsquo;./src/KMonad/Keyboard/Keycode.hs&rsquo;. Every Keycode has a name corresponding to
its Keycode name, but all lower-case and with the &rsquo;Key&rsquo; prefix removed. There
are also various aliases for Keycodes starting around line 350. If you are
trying to bind a key and there is not a 4-letter alias, please file an issue,
or better yet, a pull-request, and it will be added promptly.
</p>

<p>
Also, you can consult &rsquo;./keymap/template/&rsquo; for various input templates to use
directly or to look up keycodes by position. Here we use the input-template
for &rsquo;us_ansi_60.kbd&rsquo;
</p>
</div>
</div>
<div id="outline-container-org027b3fa" class="outline-3">
<h3 id="org027b3fa"><span class="section-number-3">2.4.</span> defalias</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Optional : `defalias` statements
</p>

<p>
KMonad will let you specify some very specific, crazy buttons. These
definitions can get pretty long, though, and would make `deflayer` blocks
nearly impossible to read. Therefore we provide the ability to alias names to
these buttons, to keep the actual `deflayer` statements orderly.
</p>

<p>
A `defalias` can contain any number of aliases, and it can refer backwards or
forwards to layers without issue. The only sequencing that needs to be kept in
mind is that a `defalias` cannot refer forward to another `defalias` that is
not yet defined.
</p>

<p>
Here we define a few aliases, but we will define more later. Notice that we
try to only use 3 letter names for aliases. If that is not enough to be clear,
consider widening all columns to 6 or 7 characters (or be content with a messy
config).
</p>
</div>
</div>
<div id="outline-container-org0fdc0f8" class="outline-3">
<h3 id="org0fdc0f8"><span class="section-number-3">2.5.</span> deflayer</h3>
<div class="outline-text-3" id="text-2-5">
<p>
Necessary: at least 1 `deflayer` block
</p>

<p>
As explained in the `defsrc` section, a `deflayer` will define a button for
each corresponding entry in the `defsrc` definition. A `deflayer` statement
consists of the `deflayer` keyword, followed by the name used to identify this
layer, followed by N &rsquo;statements-that-evaluate-to-a-button&rsquo;, where N is
exactly how many entries are defined in the `defsrc` statement.
</p>

<p>
It is also important to mention that the &rsquo;keymap&rsquo; in KMonad is modelled as a
stack of layers (just like in QMK). When an event is registered we look in the
top-most layer for a handler. If we don&rsquo;t find one we try the next layer, and
then the next.
</p>

<p>
Exactly what &rsquo;evaluates-to-a-button&rsquo; will be expanded on in more detail below.
There are very many different specialist buttons in KMonad that we will touch
upon. However, for now, these 4 are a good place to begin:
</p>

<ol class="org-ol">
<li>Any keycode evaluates to a button that, on press, emits the press of that
keycode, and on release, emits the release of that keycode. Just a &rsquo;normal&rsquo;
button. The exception is &rsquo;\&rsquo;, which gets used as an escape character. Use
&rsquo;\\&rsquo; instead. Other characters that need to be escaped to match the literal
character are &rsquo;(&rsquo;, &rsquo;)&rsquo;, and &rsquo;_&rsquo;.</li>

<li>An @-prefixed name evaluates to an alias lookup. We named two buttons in
the `defalias` block above, we could now refer to these buttons using
`@num` and `@kil`. This is also why we only use alias-names no longer than
3 characters in this tutorial. Also, note that we are already referencing
some aliases that have not yet been defined, this is not an issue.</li>

<li>The &rsquo;_&rsquo; character evaluates to transparent. I.e. no handler for that
key-event in this layer, causing this event to be handed down the layer
stack to perhaps be handled by the next layer.</li>

<li><p>
The &rsquo;XX&rsquo; character evaluates to blocked. I.e. no action bound to that
key-event in this layer, but do actually catch event, preventing any
underlying layer from handling it.
</p>

<p>
Finally, it is important to note that the <b>first</b> `deflayer` statement in a
KMonad config will be the layer that is active when KMonad starts up.
</p></li>
</ol>
</div>
<div id="outline-container-org91e8139" class="outline-4">
<h4 id="org91e8139"><span class="section-number-4">2.5.1.</span> Examples</h4>
<div class="outline-text-4" id="text-2-5-1">
<pre class="example" id="org0f65509">
(deflayer numbers
  _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    XX   /    7    8    9    -    _    _    _
  _    _    _    _    _    XX   *    4    5    6    +    _    _
  _    _    \(   \)   .    XX   0    1    2    3    _    _
  _    _    _              _              _    _    _    _
  )

(deflayer my-numbers
  _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    1    2    3    4    5    6    7    8    9    0    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _                  _
  _    _    _              _              _    _    _                    _   _
  _
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfb450d3" class="outline-3">
<h3 id="orgfb450d3"><span class="section-number-3">2.6.</span> Buttons with Modifiers</h3>
<div class="outline-text-3" id="text-2-6">
<p>
Optional: modded buttons
</p>

<p>
Let&rsquo;s start by exploring the various special buttons that are supported by
KMonad by looking at &rsquo;modded&rsquo; buttons, that is to say, buttons that activate
some kind of &rsquo;mod&rsquo;, then perform some button, and finally release that &rsquo;mod&rsquo;
again.
</p>

<p>
We have already seen an example of this style of button, our `kil` button is
one such button. Let&rsquo;s look at it in more detail:
C-A-del
</p>

<p>
This looks like a simple declarative statement, but it&rsquo;s helpful to realize
that is simply syntactic sugar around 2 function calls. This statement is
equivalent to:
(around ctl (around alt del))
</p>

<p>
This highlights a core design principle in KMonad: we try to provide very
simple buttons, and then we provide rules and functions for combining them
into new buttons. Although note: still very much a work in progress.
</p>

<p>
So, looking at this statement:
(around foo bar)
</p>

<p>
Here, `around` is a function that takes two buttons and creates a new button.
This new button will, on a press, first press foo, then press bar, and on a
release first release bar, and then foo. Once created, this new button can be
passed to anything in KMonad that expects a button.
</p>

<p>
We have already seen other examples of modded buttons, \(, \), *, and +. There
are no Keycodes for these buttons in KMonad, but they are buttons. They simply
evaluate to `(around lsft x)`. All shifted numbers have their corresponding
characters, the same is true for all capitals, and &lt; &gt; : ~ &ldquo; | { } &ensp;+ and ?.
</p>

<p>
To wrap up &rsquo;modded-buttons&rsquo;, let&rsquo;s look back at C-A-del. We have 8 variants:
C- : (around lctl X)
A- : (around lalt X)
M- : (around lmet X)
S- : (around lsft X)
</p>

<p>
Then RC-, RA-, RM-, and RS- behave exactly the same, except using the
right-modifier.
</p>

<p>
These can be combined however you please:
C-A-M-S-x          ;; Perfectly valid
C-%                ;; Perfectly valid: same as C-S-5
C-RC-RA-A-M-S-RS-m ;; Sure, but why would you?
</p>

<p>
Also, note that although we provide special syntax for certain modifiers,
these buttons are in no way &rsquo;special&rsquo; in KMonad. There is no concept of &rsquo;modifier&rsquo;.
(around a (around b c)) ;; Perfectly valid
</p>
</div>
<div id="outline-container-org2c47868" class="outline-4">
<h4 id="org2c47868"><span class="section-number-4">2.6.1.</span> Examples</h4>
<div class="outline-text-4" id="text-2-6-1">
<pre class="example" id="org5e6b7d1">
cpy C-c
pst C-v
cut C-x

;; Something silly
md1 (around a (around b c))    ;; abc
md2 (around a (around lsft b)) ;; aB
md3 C-A-M-S-l
md4 (around % b)               ;; BEWARE: %B, not %b, do you see why?
</pre>

<p>
Now we define the &rsquo;tst&rsquo; button as opening and closing a bunch of layers at
the same time. If you understand why this works, you&rsquo;re starting to grok
KMonad.
</p>

<p>
Explanation: we define a bunch of testing-layers with buttons to illustrate
the various options in KMonad. Each of these layers makes sure to have its
buttons not overlap with the buttons from the other layers, and specifies all
its other buttons as transparent. When we use the nested `around` statement,
whenever we push the button linked to &rsquo;@tst&rsquo; (check `qwerty` layer, we bind
it to `rctl`), any button we press when holding `rctl` will be pressed in the
context of those 4 layers overlayed on the stack. When we release `rctl`, all
these layers will be popped again.
</p>

<pre class="example" id="orgca5a205">
(defalias tst (around (layer-toggle macro-test)
                      (around (layer-toggle layer-test)
                              (around (layer-toggle around-next-test)
                                      (around (layer-toggle command-test)
                                              (layer-toggle modded-test))))))

(deflayer modded-test
  _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    @md4 _    _    _    _    _    _    _    _    _    _    _
  _    _    @md1 @md2 @md3 _    _    _    _    _    _    _    _
  _    _    @cut @cpy @pst _    _    _    _    _    _    _
  _    _    _              _              _    _    _    _
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb86e651" class="outline-3">
<h3 id="orgb86e651"><span class="section-number-3">2.7.</span> Sticky Keys</h3>
<div class="outline-text-3" id="text-2-7">
<p>
Optional: sticky keys
</p>

<p>
KMonad also support so called &ldquo;sticky keys&rdquo;.  These are keys that will
behave as if they were pressed after just tapping them.  This behaviour
wears off after the next button is pressed, which makes them ideal for
things like a quick control or shift.  For example, tapping a sticky and
then pressing `abc&rsquo; will result in `Abc&rsquo;.
</p>

<p>
You can create these keys with the `sticky-key&rsquo; keyword:
</p>

<p>
(defalias
slc (sticky-key 500 lctl))
</p>

<p>
The number after `sticky-key&rsquo; is the timeout you want, in milliseconds.  If
a key is tapped and that time has passed, it won&rsquo;t act like it&rsquo;s pressed
down when we receive the next keypress.
</p>

<p>
It is also possible to combine sticky keys.  For example, to
get a sticky shift+control you can do
</p>

<p>
(defalias
ssc (around
(sticky-key 500 lsft)
(sticky-key 500 lctl)))
</p>
</div>
<div id="outline-container-org206bcf0" class="outline-4">
<h4 id="org206bcf0"><span class="section-number-4">2.7.1.</span> Examples</h4>
<div class="outline-text-4" id="text-2-7-1">
<p>
Let&rsquo;s make both shift keys sticky
</p>
<pre class="example" id="org958d14c">
(defalias
  sl (sticky-key 300 lsft)
  sr (sticky-key 300 rsft))
</pre>
</div>
</div>
</div>
<div id="outline-container-orge878540" class="outline-3">
<h3 id="orge878540"><span class="section-number-3">2.8.</span> Tap Macros</h3>
<div class="outline-text-3" id="text-2-8">
<p>
Optional: tap-macros
</p>

<p>
Let&rsquo;s look at a button we haven&rsquo;t seen yet, tap-macros.
</p>

<p>
`tap-macro` is a function that takes an arbitrary number of buttons and
returns a new button. When this new button is pressed it rapidly taps all its
stored buttons in quick succesion except for its last button, which it only
presses. This last button gets released when the `tap-macro` gets released.
</p>

<p>
There are two ways to define a `tap-macro`, using the `tap-macro` function
directly, or through the #() syntactic sugar. Both evaluate to exactly the
same button.
</p>

<p>
(tap-macro K M o n a d)
#(K M o n a d)
</p>

<p>
If you are going to use a `tap-macro` to perform a sequence of actions inside
some program you probably want to include short pauses between inputs to give
the program time to register all the key-presses. Therefore we also provide
the &rsquo;pause&rsquo; function, which simply pauses processing for a certain amount of
milliseconds. Pauses can be created like this:
</p>

<p>
(pause 20)
P20
</p>

<p>
You an also pause between each key stroke by specifying the `:delay&rsquo; keyword,
as well as a time in ms, at the end of a `tap-macro&rsquo;:
</p>

<p>
(tap-macro K M o n a d :delay 5)
#(K M o n a d :delay 5)
</p>

<p>
The above would be equivalent to e.g.
</p>

<p>
(tap-macro K P5 M P5 o P5 n P5 a P5 d)
</p>

<p>
WARNING: DO NOT STORE YOUR PASSWORDS IN PLAIN TEXT OR IN YOUR KEYBOARD
</p>

<p>
I know it might be tempting to store your password as a macro, but there are 2
huge risks:
</p>
<ol class="org-ol">
<li>You accidentally leak your config and expose your password</li>
<li><p>
Anyone who knows about the button can get clear-text representation of your
password with any text editor, shell, or text-input field.
</p>

<p>
Support for triggering shell commands directly from KMonad is described in the
command buttons section below.
</p>

<p>
This concludes this public service announcement.
</p></li>
</ol>
</div>
<div id="outline-container-org49d2549" class="outline-4">
<h4 id="org49d2549"><span class="section-number-4">2.8.1.</span> Examples</h4>
<div class="outline-text-4" id="text-2-8-1">
<pre class="example" id="org5dce9f1">
(defalias
  mc1 #(K M o n a d)
  mc2 #(C-c P50 A-tab P50 C-v) ;; Careful, this might do something
  mc3 #(P200 h P150 4 P100 &gt; &lt; P50 &gt; &lt; P20 0 r z 1 ! 1 ! !)
  mc4 (tap-macro a (pause 50) @md2 (pause 50) c)
  mc5 #(@mc3 spc @mc3 spc @mc3)
  )

(deflayer macro-test
  _    @mc1 @mc2 @mc3 @mc4 @mc5 _    _    _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _              _              _    _    _    _
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc8aa6f2" class="outline-3">
<h3 id="orgc8aa6f2"><span class="section-number-3">2.9.</span> Layer Manipulation</h3>
<div class="outline-text-3" id="text-2-9">
<p>
Optional: layer manipulation
</p>

<p>
You have already seen the basics of layer-manipulation. The `layer-toggle`
button. This button adds a layer to the top of KMonad&rsquo;s layer stack when
pressed, and removes it again when released. There are a number of other ways
to manipulate the layer stack, some safer than others. Let&rsquo;s go through all of
them from safest to least safe:
</p>

<p>
`layer-toggle` works as described before, 2 things to note:
</p>
<ol class="org-ol">
<li>If you are confused or worried about pressing a key, changing layers, and
then releasing a key and this causing issues: don&rsquo;t be. KMonad handles
presses and releases in very different ways. Presses get passed directly to
the stacked keymap as previously described. When a KMonad button has its
press-action triggered, it then registers a callback that will catch its
own release before we ever touch the keymap. This guarantees that the
button triggered by the press of X <b>will be</b> the button whose release is
triggered by the release of X (the release of X might trigger other things
as well, but that is besides the point.)</li>
<li><p>
If `layer-toggle` can only ever add and then necessarily remove 1 layer
from the stack, then it will never cause a permanent change, and is
perfectly safe.
</p>

<p>
`layer-delay`, once pressed, temporarily switches to some layer for some
milliseconds. Just like `layer-toggle` this will never permanently mess-up the
layer stack. This button was initially implemented to provide some
&rsquo;leader-key&rsquo; style behavior. Although I think in the future better solutions
will be available. For now this will temporarily add a layer to the top of the
stack:
(layer-delay 500 my-layer)
</p>

<p>
`layer-next`, once pressed, primes KMonad to handle the next press from some
arbitrary layer. This aims to fill the same usecase as `layer-delay`: the
beginnings of &rsquo;leader-key&rsquo; style behavior. I think this whole button will get
deleted soon, because the more general `around-next` now exists (see below)
and this is nothing more than:
(around-next (layer-toggle layer-name) some-button)
Until then though, use `layer-next` like this:
(layer-next layer-name)
</p>

<p>
`layer-switch`: change the base-layer of KMonad. As described at the top of
this document, the first `deflayer` statement is the layer that is active when
KMonad starts. Since `layer-toggle` can only ever add on and remove from the
top of that, it can never change the base-layer. The following button will
unregister the bottom-most layer of the keymap, and replace it with another
layer.
(layer-switch my-layer)
</p>

<p>
This is where things start getting potentially dangerous (i.e. get KMonad into
an unusuable state until a restart has occured). It is perfectly possible to
switch into a layer that you can never get out of. Or worse, you could
theoretically have a layer full of only `XX`s and switch into that, rendering
your keyboard unuseable until you somehow manage to kill KMonad (without using
your keyboard).
</p>

<p>
However, when handled well, `layer-switch` is very useful, letting you switch
between &rsquo;modes&rsquo; for your keyboard. I have a tiny keyboard with a weird keymap,
but I switch into a simple &rsquo;qwerty&rsquo; keymap shifted 1 button to the right for
gaming. Just make sure that any &rsquo;mode&rsquo; you switch into has a button that
allows you to switch back out of the &rsquo;mode&rsquo; (or content yourself restarting
KMonad somehow).
</p>

<p>
`layer-add` and `layer-rem`. This is where you can very quickly cause yourself
a big headache. Originally I didn&rsquo;t expose these operations, but someone
wanted to use them, and I am not one to deny someone else a chainsaw. As the
names might give away:
(layer-add name) ;; Add a layer to the top of the stack
(layer-rem name) ;; Remove a layer by name (noop if no such layer)
</p>

<p>
To use `layer-add` and `layer-rem` well, you should take a moment to think
about how to create a layout that will prevent you from getting into
situations where you enter a key-configuration you cannot get out of again.
These two operations together, however, are very useful for activating a
permanent overlay for a while. This technique is illustrated in the tap-hold
overlay a bit further down.
</p></li>
</ol>
</div>
<div id="outline-container-org1bda5b0" class="outline-4">
<h4 id="org1bda5b0"><span class="section-number-4">2.9.1.</span> Examples</h4>
<div class="outline-text-4" id="text-2-9-1">
<pre class="example" id="org6d638da">
(defalias
  yah (layer-toggle asking-for-trouble) ;; Completely safe
  nah (layer-add asking-for-trouble)    ;; Completely unsafe

  ld1 (layer-delay 500 numbers) ;; One way to get a leader-key
  ld2 (layer-next numbers)      ;; Another way to get a leader key

  ;; NOTE, this is safe because both `qwerty` and `colemak` contain the `@tst`
  ;; button which will get us to the `layer-test` layer, which itself contains
  ;; both `@qwe` and `@col`.
  qwe (layer-switch qwerty) ;; Set qwerty as the base layer
  col (layer-switch colemak) ;; Set colemak as the base layer
  )

(deflayer layer-test
  @qwe _    _    _    _    _    _    _    _    _    _    @add _    @nah
  @col _    _    _    _    _    _    _    _    _    _    _    _    @yah
  _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    @ld1 @ld2 _
  _    _    _              _              _    _    _    _
  )

;; Exactly like qwerty, but with the letters switched around
(deflayer colemak
  grv  1    2    3    4    5    6    7    8    9    0    -    =    bspc
  tab  q    w    f    p    g    j    l    u    y    ;    [    ]    \
  @xcp a    r    s    t    d    h    n    e    i    o    '    ret
  @sl  z    x    c    v    b    k    m    ,    .    /    @sr
  lctl @num lalt           spc            ralt rmet @sym @tst
  )

(defalias lol #(: - D))

;; Contrived example
(deflayer asking-for-trouble
  @lol @lol @lol @lol @lol @lol @lol @lol @lol @lol @lol @lol @lol @lol
  @lol @lol @lol @lol @lol @lol @lol @lol @lol @lol @lol @lol @lol @lol
  @lol @lol @lol @lol @lol @lol @lol @lol @lol @lol @lol @lol @lol
  @lol @lol @lol @lol @lol @lol @lol @lol @lol @lol @lol @lol
  @lol @lol @lol           @lol           @lol @lol @lol @lol
  )

;; One way to safely use layer-add and layer-rem: the button bound to layer-add
;; is the same button bound to layer-rem in the layer that `add` adds to the
;; stack. I.e., it becomes impossible to add or remove multiple copies of a
;; layer.
(defalias
  add (layer-add multi-overlay) ;; multi-overlay is defined in the next
  rem (layer-rem multi-overlay) ;; section below this
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org1ba2d2e" class="outline-3">
<h3 id="org1ba2d2e"><span class="section-number-3">2.10.</span> Multi-use Buttons</h3>
<div class="outline-text-3" id="text-2-10">
<p>
Optional: Multi-use buttons
</p>

<p>
Perhaps one of the most useful features of KMonad, where a lot of work has
gone into, but also an area with many buttons that are ever so slightly
different. The naming and structuring of these buttons might change sometime
soon, but for now, this is what there is.
</p>

<p>
For the next section being able to talk about examples is going to be handy,
so consider the following scenario and mini-language that will be the same
between scenarios.
</p>
<ul class="org-ul">
<li>We have some button `foo` that will be different between scenarios</li>
<li>`foo` is bound to &rsquo;Esc&rsquo; on the input keyboard</li>
<li>the letters a s d f are bound to themselves</li>
<li>Px  signifies the press of button x on the keyboard</li>
<li>Rx  signifies the release of said button</li>
<li>Tx  signifies the sequential and near instantaneous press and release of x</li>
<li><p>
100 signifies 100ms pass
</p>

<p>
So for example:
Tesc Ta:
tap of &rsquo;Esc&rsquo; (triggering `foo`), tap of &rsquo;a&rsquo; triggering `a`
Pesc 100 Ta Tb Resc:
press of &rsquo;Esc&rsquo;, 100ms pause, tap of &rsquo;a&rsquo;, tap of &rsquo;b&rsquo;, release of &rsquo;Esc&rsquo;
</p>

<p>
The `tap-next` button takes 2 buttons, one for tapping, one for holding, and
combines them into a single button. When pressed, if the next event is its own
release, we tap the &rsquo;tapping&rsquo; button. In all other cases we first press the
&rsquo;holding&rsquo; button then we handle the event. Then when the `tap-next` gets
released, we release the &rsquo;holding&rsquo; button.
</p>

<p>
So, using our mini-language, we set foo to:
(tap-next x lsft)
Then:
Tesc            -&gt; x
Tesc Ta         -&gt; xa
Pesc Ta Resc    -&gt; A
Pesc Ta Tr Resc -&gt; AR
</p>

<p>
The `tap-hold` button is very similar to `tap-next` (a theme, trust me). The
difference lies in how the decision is made whether to tap or hold. A
`tap-hold` waits for a particular timeout, if the `tap-hold` is released
anywhere before that moment we execute a tap immediately. If the timeout
occurs and the `tap-hold` is still held, we switch to holding mode.
</p>

<p>
The additional feature of a `tap-hold` is that it pauses event-processing
until it makes its decision and then rolls back processing when the decision
has been made.
</p>

<p>
So, again with the mini-language, we set foo to:
(tap-hold 200 x lsft) ;; Like tap-next, but with a 200ms timeout
Then:
Tesc            -&gt; x
Tesc Ta         -&gt; xa
Pesc 300 a      -&gt; A (the moment you press a)
Pesc a 300      -&gt; A (after 200 ms)
Pesc a 100 Resc -&gt; xa (both happening immediately on Resc)
</p>

<p>
The `tap-hold-next` button is a combination of the previous 2. Essentially,
think of it as a `tap-next` button, but it also switches to held after a
period of time. This is useful, because if you have a (tap-next ret ctl) for
example, and you press it thinking you want to press C-v, but then you change
your mind, you now cannot release the button without triggering a &rsquo;ret&rsquo;, that
you then have to backspace. With the `tap-hold-next` button, you simply
outwait the delay, and you&rsquo;re good. I see no benefit of `tap-next` over
`tap-hold-next` with a decent timeout value.
</p>

<p>
The `tap-next-release` is like `tap-next`, except it decides whether to tap or
hold based on the next release of a key that was <b>not</b> pressed before us. This
also performs rollback like `tap-hold`.So, using the minilanguage and foo as:
(tap-next-release x lsft)
Then:
Tesc Ta         -&gt; xa
Pa Pesc Ra Resc -&gt; ax (because &rsquo;a&rsquo; was already pressed when we started, so
foo decides it is tapping)
Pesc Ta Resc    -&gt; A (because a was pressed <b>and</b> released after we started,
so foo decides it is holding)
</p>

<p>
These increasingly stranger buttons are, I think, coming from the stubborn
drive of some of my more eccentric (and I mean that in the most positive way)
users to make typing with modifiers on the home-row more comfortable.
Especially layouts that encourage a lot of rolling motions are nicer to use
with the `release` style buttons.
</p>

<p>
The `tap-hold-next-release` (notice a trend?) is just like `tap-next-release`,
but it comes with an additional timeout that, just like `tap-hold-next` will
jump into holding-mode after a timeout.
</p>

<p>
I honestly think that `tap-hold-next-release`, although it seems the most
complicated, probably is the most comfortable to use. But I&rsquo;ve put all of them
in a testing layer down below, so give them a go and see what is nice.
</p></li>
</ul>
</div>
<div id="outline-container-orge172632" class="outline-4">
<h4 id="orge172632"><span class="section-number-4">2.10.1.</span> Examples</h4>
<div class="outline-text-4" id="text-2-10-1">
<pre class="example" id="orga060fd8">
(defalias
  xtn (tap-next x lsft)         ;; Shift that does 'x' on tap
  xth (tap-hold 400 x lsft)     ;; Long delay for easier testing
  thn (tap-hold-next 400 x lsft)
  tnr (tap-next-release x lsft)
  tnh (tap-hold-next-release 2000 x lsft)

  ;; Used it the colemak layer
  xcp (tap-hold-next 400 esc ctl)
  )

;; Some of the buttons used here are defined in the next section
(deflayer multi-overlay
  @mt  _    _    _    _    _    _    _    _    _    _    _    @rem _
  _    _    _    _    _    _    _    _    _    _    _    _    _    _
  @thn _    _    _    _    _    _    _    _    _    _    _    _
  @xtn _    _    _    _    _    _    _    _    _    _    @xth
  @tnr _    _              _              _    _    _    @tnh
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb5c04a8" class="outline-3">
<h3 id="orgb5c04a8"><span class="section-number-3">2.11.</span> Multi-tap</h3>
<div class="outline-text-3" id="text-2-11">
<p>
Optional: Multi-tap
</p>

<p>
Besides the tap-hold style buttons there is another multi-use button (with.
only 1 variant, at the moment). The `multi-tap`.
</p>

<p>
A `multi-tap` codes for different buttons depending on how often it is tapped.
It is defined by a series of delays and buttons, followed by a last button
without delay. As long as you tap the `multi-tap` within the delay specified,
it will jump to the next button. Once the delay is exceeded the selected
button is pressed. If the last button in the list is reached, it is
immediately pressed.
</p>

<p>
Note that you can actually hold the button, so in the below example, going:
tap-tap-hold (wait 300ms) will get you a pressed c, until you release again.
</p>
</div>
<div id="outline-container-orgc820926" class="outline-4">
<h4 id="orgc820926"><span class="section-number-4">2.11.1.</span> Examples</h4>
<div class="outline-text-4" id="text-2-11-1">
<pre class="example" id="orgaa492a2">
(defalias
  mt  (multi-tap 300 a 300 b 300 c 300 d e))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb976a06" class="outline-3">
<h3 id="orgb976a06"><span class="section-number-3">2.12.</span> Around-next</h3>
<div class="outline-text-3" id="text-2-12">
<p>
Optional: Around-next
</p>

<p>
The `around-next` function creates a button that primes KMonad to perform the
next button-press inside some context. This could be the context of &rsquo;having
Shift pressed&rsquo; or &rsquo;being inside some layer&rsquo; or, less usefully, &rsquo;having d
pressed&rsquo;. It is a more general and powerful version of `layer-next`.
</p>

<p>
I think expansion of this button-style is probably the future of leader-key,
hydra-style functionality support in KMonad.
</p>
</div>
<div id="outline-container-org8926683" class="outline-4">
<h4 id="org8926683"><span class="section-number-4">2.12.1.</span> Examples</h4>
<div class="outline-text-4" id="text-2-12-1">
<pre class="example" id="org903e287">
(defalias
  ns  (around-next sft)  ;; Shift the next press
  nnm (around-next @num) ;; Perform next press in numbers layer
  nd  (around-next d)    ;; Silly, but possible

  )

(deflayer around-next-test
  _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _    _    _
  @nd  _    _    _    _    _    _    _    _    _    _    _    _
  @nnm _    _    _    _    _    _    _    _    _    _    _
  @ns  _    _              _              _    _    _    _
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org30b1890" class="outline-3">
<h3 id="org30b1890"><span class="section-number-3">2.13.</span> Compose Key Sequences</h3>
<div class="outline-text-3" id="text-2-13">
<p>
Optional: Compose-key sequences
</p>

<p>
Compose-key sequences are series of button-presses that your operating system
will interpret as the insertion of a special character, like accented
characters, or various special-languages. In that sense, they are just
syntactic sugar for keyboard macros.
</p>

<p>
To get this to work on Linux you will need to set your compose-key with a tool
like `setxkbmap&rsquo;, as well as tell kmonad that information. See the `defcfg&rsquo;
block at the top of this file for a working example. Note that you need to
wait ever so slightly for the keyboard to register with linux before the
command gets executed, that&rsquo;s why the `sleep 1`. Also, note that all the
`/run/current-system&rsquo; stuff is because the author uses NixOS. Just find a
shell-command that will:
</p>

<ol class="org-ol">
<li>Sleep a moment</li>
<li><p>
Set the compose-key to your desired key
</p>

<p>
Please be aware that what `setxkbmap&rsquo; calls the `menu&rsquo; key is not actually the
`menu&rsquo; key! If you want to use the often suggested
</p>

<p>
setxkbmap -option compose:menu
</p>

<p>
you will have to set your compose key within kmonad to `compose&rsquo; and not
`menu&rsquo;.
</p>

<p>
After this, this should work out of the box under Linux. Windows does not
recognize the same compose-key sequences, but WinCompose will make most of the
sequences line up with KMonad: <a href="http://wincompose.info/">http://wincompose.info/</a>
This has not in any way been tested on Mac.
</p>

<p>
In addition to hard-coded symbols, we also provide &rsquo;uncompleted&rsquo; macros. Since
a compose-key sequence is literally just a series of keystrokes, we can omit
the last one, and enter the sequence for &rsquo;add an umlaut&rsquo; and let the user then
press some letter to add this umlaut to. These are created using the `+&ldquo;`
syntax.
</p></li>
</ol>
</div>
<div id="outline-container-orgf3a3bde" class="outline-4">
<h4 id="orgf3a3bde"><span class="section-number-4">2.13.1.</span> Examples</h4>
<div class="outline-text-4" id="text-2-13-1">
<pre class="example" id="org57142b2">
(defalias
  sym (layer-toggle symbols)
  )

(deflayer symbols
  _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    ä    é    ©    _    _    _    _    _    _    _    _    _    _
  _    +'   +~   +`   +^   _    _    _    _    _    _    _    _
  _    +"   _    _    _    _    _    _    _    _    _    _
  _    _    _              _              _    _    _    _)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc6c7291" class="outline-3">
<h3 id="orgc6c7291"><span class="section-number-3">2.14.</span> Command Buttons</h3>
<div class="outline-text-3" id="text-2-14">
<p>
Optional: Command buttons
</p>

<p>
Currently we also provide the ability to launch arbitrary shell-commands from
inside kmonad. These commands are simply handed off to the command-shell
without any further checking or waiting.
</p>

<p>
NOTE: currently only tested on Linux, but should work on any platform, as long
as the command is valid for that platform.
</p>

<p>
The `cmd-button&rsquo; function takes two arguments, the second one of which is
optional. These represent the commands to be executed on pressing and
releasing the button respectively.
</p>

<p>
BEWARE: never run anyone&rsquo;s configuration without looking at it. You wouldn&rsquo;t
want to push:
</p>

<p>
(cmd-button &ldquo;rm -rf ~/*&rdquo;) ;; Delete all this user&rsquo;s data
</p>

<pre class="example" id="org7ecb1fe">
(defalias
  dat (cmd-button "date &gt;&gt; /tmp/kmonad_example.txt")   ;; Append date to tmpfile
  pth (cmd-button "echo $PATH &gt; /tmp/kmonad_path.txt") ;; Write out PATH
  ;; `dat' on press and `pth' on release
  bth (cmd-button "date &gt;&gt; /tmp/kmonad_example.txt"
                   "echo $PATH &gt; /tmp/kmonad_path.txt")
  )

(deflayer command-test
  _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    @dat @pth _
  _    _    _              _              _    _    _    _
  )
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Sridaran Thoniyil</p>
<p class="date">Created: 2023-11-14 Tue 17:09</p>
</div>
</body>
</html>